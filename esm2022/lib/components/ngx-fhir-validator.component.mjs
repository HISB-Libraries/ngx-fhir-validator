import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { ValidatorConstants } from "../providers/validator-constants";
import { FormControl, FormGroup, UntypedFormControl, Validators } from "@angular/forms";
import { MatTableDataSource } from "@angular/material/table";
import { animate, state, style, transition, trigger } from "@angular/animations";
import * as i0 from "@angular/core";
import * as i1 from "../services/fhir-validator.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/material/form-field";
import * as i4 from "@angular/material/button";
import * as i5 from "@angular/forms";
import * as i6 from "@angular/material/icon";
import * as i7 from "@angular/material/table";
import * as i8 from "@angular/material/progress-spinner";
import * as i9 from "@angular/material/radio";
import * as i10 from "@angular/material/card";
import * as i11 from "@angular/material/select";
import * as i12 from "@angular/material/core";
import * as i13 from "@angular/material/button-toggle";
import * as i14 from "@angular/material/checkbox";
import * as i15 from "@angular/material/tooltip";
export class NgxFhirValidatorComponent {
    constructor(fhirValidatorService) {
        this.fhirValidatorService = fhirValidatorService;
        this.validatorTitle = '';
        this.validationResultsExpanded = false; // Validation results details initial state
        this.resultDetailsExpandBtnShown = true; // Show/hide Expand Validation Results btn
        this.formatResourceBtnShown = false; // Show/hide Format Resource btn
        this.clearValidatorBtnShown = true; // Show/hide Clear Validator btn
        this.submitBtnShown = true; // Show/hide Submit btn
        this.exportResultsButtonShown = true;
        this.submitBtnTitle = 'Submit'; //The submit button title. "Submit" is generic name and other apps may want to change it
        this.validationInputFormat = { format: 'json', accepts: '.json' };
        this.maxFileSize = 250000; // Max allowed file size is 250KB
        this.submitBtnAlignment = 'right'; // The default location for the Submit btn
        this.cancelValidationBtnShown = true;
        this.buttonTxtColor = 'white';
        this.buttonBackgroundColor = '#4858B8';
        this.exportValidationResultsBtnName = 'Export Results (.zip)';
        this.onValidation = new EventEmitter();
        this.onApiError = new EventEmitter();
        this.onResourceContentChanged = new EventEmitter();
        this.onExportValidationResults = new EventEmitter();
        this.fhirResource = ''; // The Resource.
        this.resourceFormat = 'json'; // The resource format could be JSON or XML, with JSON being the default format.
        this.fileName = ''; // Name of the file uploaded by the user. We need this to render the filename in the UI.
        this.validationErrorStr = ''; // We use this value to store preliminary error messages or a generic error message.
        this.hasResponseData = false; // Indicates if the response generated any messages. If true, we render the report
        this.parsedFhirResource = ''; // We store value of the validator result in order to present it to the user.
        this.isLoading = false;
        this.allExpanded = true; // Used to render collapsed/expanded all icon as well as calculate if all results are expanded/collapsed
        this.severityLevels = ValidatorConstants.SEVERITY_LEVELS;
        this.validationFinished = false;
        this.isValidResource = false; // We use this to render the success message
        this.serverErrorDetected = false; // Tracks if the server has responded with an error (404, 500). Used to render the error in UI.
        this.serverErrorList = []; // Store the data from the OperationOutcome resource
        this.serverErrorStatus = ''; // We store the error response status here (i.e. 404, 500)
        this.lines = 1;
        this.width = 0;
        this.igList = [];
        this.igNameList = [];
        this.igVersionList = [];
        //TODO remove this code when the API returns a timeout error
        this.serverTimoutDetected = false;
        this.SERVER_TIMEOUT_INTERVAL = 240000; //four minutes
        this.igSelectionFg = new FormGroup({});
        this.displayedColumns = ValidatorConstants.DISPLAYED_COLUMNS;
        this.severityLevelsFormControl = new UntypedFormControl(this.severityLevels);
        this.dataSource = new MatTableDataSource();
        this.apiResponse = null;
    }
    ngOnInit() {
        if (this.ig) {
            this.selectedIG = this.ig;
        }
        else {
            this.getIgList();
        }
    }
    getIgList() {
        this.fhirValidatorService.getIgList().subscribe({
            next: (value) => {
                this.igList = value;
                this.igNameList = value.map(el => el.name);
                this.igNameList = [...new Set(this.igNameList)];
                this.igVersionList = value.map(el => el.version);
                this.igSelectionFg.addControl('selectedIgName', new FormControl('', Validators.required));
                this.igSelectionFg.addControl('selectedIgVersion', new FormControl(''));
                this.igSelectionFg.controls['selectedIgName'].valueChanges.subscribe({
                    next: value => {
                        this.getIgVersionsList(value, this.igList);
                        this.igSelectionFg.controls['selectedIgVersion'].patchValue('current');
                    }
                });
            },
            error: err => console.error(err)
        });
    }
    formatFhirResource() {
        if (this.fhirResource) {
            if (this.resourceFormat === 'json' && this.fhirValidatorService.isJson(this.fhirResource)) {
                this.fhirResource = this.fhirValidatorService.beautifyJSON(this.fhirResource);
            }
            else if (this.resourceFormat === 'xml' && this.fhirValidatorService.isXmlString(this.fhirResource)) {
                this.fhirResource = this.fhirValidatorService.beautifyXML(this.fhirResource);
            }
        }
        this.lineNumbers();
    }
    lineNumbers() {
        const linedStrings = this.fhirResource.split(/[\n\r]/g);
        this.lines = linedStrings.length;
        this.width = this.inputRef.nativeElement.offsetWidth;
        const charInLines = this.width / ValidatorConstants.FONT_WIDTH;
        for (const line of linedStrings) {
            if (line.length > charInLines) {
                this.lines = this.lines + (line.length / charInLines);
            }
        }
    }
    getLineNumbers() {
        return Array.from({ length: this.lines }, (_, i) => (i + 1).toString());
    }
    // It is important the format is working with "best effort"
    // That is it may or may not format the text properly and require extensive testing to validate its operation.
    onFormatInput() {
        this.formatFhirResource();
        this.fhirValidatorService.showSuccessMessage("Formatting Attempted.");
    }
    clearUI() {
        this.fhirResource = '';
        this.fileName = '';
        this.clearValidationErrors();
        this.onResourceContentChanged.emit(this.fhirResource);
    }
    onClear() {
        this.clearUI();
    }
    onFileSelected(event) {
        const file = event.target.files[0];
        if (file) {
            if (file.size > this.maxFileSize) {
                console.error("File too big");
                this.fhirValidatorService.showErrorMessage("This file exceeds " + this.maxFileSize / 1000 + "kb and cannot be processed");
            }
            else {
                // auto toggle the file type radio buttons
                if (file.type === "text/xml") {
                    this.resourceFormat = 'xml';
                }
                else if ("application/json") {
                    this.resourceFormat = 'json';
                }
                // set the filename in the UI
                this.fileName = file.name;
                const reader = new FileReader();
                reader.readAsText(file, "UTF-8");
                reader.onload = () => {
                    this.fhirResource = reader.result;
                    this.onResourceContentChanged.emit(this.fhirResource);
                    this.formatFhirResource();
                };
                reader.onerror = () => {
                    this.fhirValidatorService.showErrorMessage("Unable to open the file.");
                };
            }
        }
        else {
            this.fhirValidatorService.showErrorMessage("Unable to open the file.");
        }
    }
    validateFhirResource(fhirResource, resourceFormat) {
        // Set the stage for the validation. Reset variables to default values.
        if (!fhirResource) {
            fhirResource = this.fhirResource;
        }
        if (!resourceFormat) {
            resourceFormat = this.resourceFormat;
        }
        if (this.igSelectionFg.controls?.['selectedIgName']) {
            this.igSelectionFg.controls['selectedIgName'].markAsTouched();
            this.igSelectionFg.controls['selectedIgName'].updateValueAndValidity();
            if (this.igSelectionFg.valid) {
                this.setSelectedIg(this.igSelectionFg.controls['selectedIgName'].value, this.igSelectionFg.controls['selectedIgVersion'].value);
            }
        }
        this.isValidResource = true;
        this.hasResponseData = false;
        this.serverErrorList = [];
        this.serverErrorStatus = '';
        this.serverErrorDetected = false;
        this.serverTimoutDetected = false;
        this.severityLevelsFormControl.patchValue(this.severityLevels);
        this.validationErrorStr = this.fhirValidatorService.getUiValidationMessages(fhirResource, resourceFormat, this.selectedIG);
        if (this.validationErrorStr) {
            //see if we can find any obvious issues with the resource here
            this.isValidResource = false;
            this.validationFinished = true;
            this.onValidation.emit({ hasBasicErrors: true, isValid: false, resource: fhirResource });
        }
        else {
            // The UI validation passed successfully, and we execute the backend validation.
            this.executeAPIValidation(fhirResource, resourceFormat, this.selectedIG?.canonicalUrl);
        }
    }
    onPasteFhirResource(event) {
        this.fileName = '';
        if (!this.fhirResource) {
            this.clearUI();
        }
        let text = event.clipboardData?.getData('text') ?? '';
        if (this.fhirValidatorService.isJson(text)) {
            this.resourceFormat = 'json';
        }
        else if (this.fhirValidatorService.isXmlString(text)) {
            this.resourceFormat = 'xml';
        }
    }
    getLineNumbersBySeverity(apiResponse, severity) {
        if (!apiResponse || apiResponse.issue?.length === 0) {
            return [];
        }
        return apiResponse.issue
            .filter(element => element.severity == severity)
            .filter(element => element.location)
            .map(element => this.getLineNumberFromLocation(element.location[0]) - 1);
    }
    ;
    scrollToElement(location) {
        const element = document.querySelector(location);
        if (element)
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    getLineNumberFromLocation(locationStr) {
        // Get the location from response
        return (locationStr?.length > 0) ? parseInt(locationStr.split(",")[0].replace(/^\D+/g, '')) : 0;
    }
    // When the user selects a location from the errors and warning results, we want to scroll the page to that location.
    onLocationSelected(response) {
        let locationId = ('#mark' + this.getLineNumberFromLocation(response.location[0])).toLowerCase();
        this.scrollToElement(locationId);
    }
    // Sends fhir resource to be validated, renders response
    executeAPIValidation(fhirResource, resourceFormat, ig) {
        // Reset values to default state prior to validation.
        this.isLoading = true;
        this.parsedFhirResource = '';
        this.validationFinished = false;
        this.apiResponse = null;
        if (this.resourceFormat === "json") {
            fhirResource = JSON.parse(fhirResource);
        }
        else if (this.resourceFormat === "xml") {
            let fhirResourceXML = new DOMParser().parseFromString(fhirResource, 'text/xml');
            fhirResource = fhirResourceXML.documentElement.outerHTML;
        }
        this.fhirValidatorService.validateFhirResource(fhirResource, resourceFormat, ig)
            .subscribe({
            next: (response) => {
                this.validationFinished = true;
                let issue = response.issue;
                if (issue.length === 1 && issue[0].severity === "Information" && issue[0]?.message.toLowerCase() === "ALL OK".toLowerCase()) {
                    this.isValidResource = true;
                    this.onValidation.emit({ isValid: true, resource: fhirResource });
                }
                else {
                    this.isValidResource = false;
                    this.validationErrorStr = "Please see the validation errors below.";
                    this.setValidatorResponse(response, fhirResource);
                }
                // Some strings produced by the validator are long and miss spaces. This could break the UI validation report.
                // Therefore, we insert a space after each coma found in the validation response text.
                issue.forEach((element) => {
                    element.diagnostics = element.diagnostics.replace(/,(?=[^\s])/g, ", ");
                });
                // sort by line numbers
                issue = issue.sort((a, b) => {
                    return this.getLineNumberFromLocation(a.location?.[0]) - this.getLineNumberFromLocation(b.location?.[0]);
                });
                // mat each item of the response to an object and make sure that the results are in expanded state in the
                // UI validation report.
                this.dataSource.data = issue.map((element) => {
                    let result = Object.assign({}, element);
                    result.expanded = true;
                    return result;
                });
                this.dataSource.filterPredicate = this.getFilterPredicate();
                this.apiResponse = response;
                this.apiResponse.formattedResource = response?.extension?.[0]?.valueString;
            },
            error: (err) => {
                this.isLoading = false;
                this.serverErrorDetected = true;
                this.serverErrorStatus = err.status;
                if (err?.error?.issue) {
                    this.serverErrorList = err.error.issue;
                }
                this.onApiError.emit(err);
                console.error(err);
            },
            complete: () => {
                this.isLoading = false;
            }
        });
        //TODO make sure to remove this function when the server side timeout is implemented.
        setTimeout(() => {
            if (this.isLoading) {
                this.isLoading = false;
                this.serverTimoutDetected = true;
            }
        }, this.SERVER_TIMEOUT_INTERVAL);
    }
    toggle() {
        this.allExpanded = !this.allExpanded;
        this.dataSource.data.forEach((item) => item.expanded = this.allExpanded);
    }
    onFilterResults() {
        this.dataSource.filter = this.severityLevelsFormControl.value.join(',');
    }
    getFilterPredicate() {
        return function (row, filters) {
            let matchFilter = false;
            const filterArray = filters.split(',');
            filterArray.forEach((filter) => {
                if (row.severity.toLowerCase().indexOf(filter.toLowerCase()) != -1) {
                    matchFilter = true;
                }
            });
            return matchFilter;
        };
    }
    onCancelValidation() {
        this.isLoading = false;
    }
    checkExpandCollapseAllStatus() {
        /*
        * When all elements are collapsed we want to change the expansion icon to render "expand all"
        * When all elements are expanded we want to change the expansion icon to "collapse all"
        * This will save extra unnecessary click for the user
        */
        const expandedElementsCount = this.dataSource.data.filter(element => element['expanded']).length;
        if (expandedElementsCount === this.dataSource.data.length) {
            this.allExpanded = true;
        }
        else if (expandedElementsCount === 0) {
            this.allExpanded = false;
        }
    }
    isFilterEnabled(severity) {
        return !!this.dataSource.data.find((element) => element.severity.toLowerCase() === severity.toLowerCase());
    }
    getCount(level) {
        return this.dataSource.data
            .filter((element) => element.severity.toLowerCase() === level.toLowerCase())
            .length;
    }
    onCloseServerErrorMessage() {
        this.serverErrorDetected = false;
        this.serverErrorList = [];
        this.serverErrorStatus = '';
    }
    setValidatorResponse(apiResponse, resource) {
        const errorsCount = apiResponse.issue.filter((element) => element.severity == 'error')?.length ?? 0;
        const warningsCount = apiResponse.issue.filter((element) => element.severity == 'warning')?.length ?? 0;
        const infoCount = apiResponse.issue.filter((element) => element.severity == 'information')?.length ?? 0;
        const notesCount = apiResponse.issue.filter((element) => element.severity == 'note')?.length ?? 0;
        let validationResult = {};
        validationResult.errorsCount = errorsCount;
        validationResult.warningsCount = warningsCount;
        validationResult.notesCount = notesCount;
        validationResult.infoCount = infoCount;
        validationResult.isValid = errorsCount <= 0;
        validationResult.resource = resource;
        this.onValidation.emit(validationResult);
    }
    clearValidationErrors() {
        this.validationErrorStr = '';
        this.isValidResource = false;
        this.parsedFhirResource = '';
        this.hasResponseData = false;
        this.validationFinished = false;
        this.isLoading = false;
        this.serverErrorDetected = false;
        this.serverErrorList = [];
        this.serverErrorStatus = '';
        this.serverTimoutDetected = false;
        this.apiResponse = null;
    }
    getLineItemClass(item, i) {
        if (this.getLineNumbersBySeverity(this.apiResponse, 'error').indexOf(i) != -1) {
            this.hasResponseData = true;
            return "error-mark";
        }
        else if (this.getLineNumbersBySeverity(this.apiResponse, 'warning').indexOf(i) != -1) {
            this.hasResponseData = true;
            return "warning-mark";
        }
        else if (this.getLineNumbersBySeverity(this.apiResponse, 'information').indexOf(i) != -1) {
            this.hasResponseData = true;
            return "info-mark";
        }
        else if (this.getLineNumbersBySeverity(this.apiResponse, 'note').indexOf(i) != -1) {
            this.hasResponseData = true;
            return "note-mark";
        }
        else
            return '';
    }
    exportValidationResults() {
        // Add the formatted resource form the validator response to a json file
        // This way the line numbers from the validator report will match the json file numbers
        const jsonResource = this?.apiResponse?.formattedResource || '';
        // Create a pdf report
        const resultsData = this.dataSource.data
            .map(element => { return { severity: element.severity, diagnostics: element.diagnostics, location: element.location, fhirPath: element?.expression?.[0] }; })
            .filter(item => this.severityLevelsFormControl.value.indexOf(item.severity) != -1);
        this.onExportValidationResults.emit({ jsonResource: jsonResource, resultsData: resultsData });
    }
    getIgVersionsList(selectedIgName, igList) {
        this.igVersionDropdownList = igList.filter(el => el.name == selectedIgName).map(el => el.version);
        this.selectedIgVersion = this.igVersionList.find(el => el == 'current');
        this.selectedIG = this.igList.find(el => el.name == selectedIgName && el.version == this.selectedIgVersion);
        this.igSelectionFg.controls['selectedIgVersion'].patchValue(this.selectedIgVersion);
    }
    setSelectedIg(selectedIgName, selectedIgVersion) {
        this.selectedIG = this.igList.find(el => el.name == selectedIgName && el.version == selectedIgVersion);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.0", ngImport: i0, type: NgxFhirValidatorComponent, deps: [{ token: i1.FhirValidatorService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.0.0", type: NgxFhirValidatorComponent, selector: "lib-ngx-fhir-validator", inputs: { validatorTitle: "validatorTitle", validationResultsExpanded: "validationResultsExpanded", resultDetailsExpandBtnShown: "resultDetailsExpandBtnShown", formatResourceBtnShown: "formatResourceBtnShown", clearValidatorBtnShown: "clearValidatorBtnShown", submitBtnShown: "submitBtnShown", exportResultsButtonShown: "exportResultsButtonShown", submitBtnTitle: "submitBtnTitle", validationInputFormat: "validationInputFormat", maxFileSize: "maxFileSize", submitBtnAlignment: "submitBtnAlignment", cancelValidationBtnShown: "cancelValidationBtnShown", buttonTxtColor: "buttonTxtColor", buttonBackgroundColor: "buttonBackgroundColor", exportValidationResultsBtnName: "exportValidationResultsBtnName", ig: "ig" }, outputs: { onValidation: "onValidation", onApiError: "onApiError", onResourceContentChanged: "onResourceContentChanged", onExportValidationResults: "onExportValidationResults" }, viewQueries: [{ propertyName: "inputRef", first: true, predicate: ["validatorInput"], descendants: true, read: ElementRef }], ngImport: i0, template: "@if (isLoading) {\n  <div class=\"spinner-container\">\n    <mat-spinner></mat-spinner>\n  </div>\n}\n\n@if (validatorTitle) {\n  <mat-card-header  id=\"validator-title\">\n    <mat-card-title>{{ validatorTitle }}</mat-card-title>\n  </mat-card-header>\n}\n\n\n<!-- The section below renders error messages returned by the validator.-->\n@if (serverErrorDetected) {\n  <div class=server-error-message-container>\n    <button mat-button class=\"close-button\" color=\"accent\" aria-label=\"Close\" disableRipple\n      (click)=\"onCloseServerErrorMessage()\">\n      <mat-icon>close</mat-icon>\n    </button>\n    <div class=\"server-error-status\"><h2>Server Error Response Status: {{ serverErrorStatus }}</h2></div>\n    @for (serverError of serverErrorList; track serverError) {\n      <div class=\"server-error-message-text\"\n      [innerText]=\"serverError.diagnostics\"></div>\n    }\n  </div>\n}\n\n<!-- TODO remove this code when the API code is updated to return 408 on request timeout -->\n@if (serverTimoutDetected) {\n  <div class=server-error-message-container>\n    <button mat-button class=\"close-button\" color=\"accent\" aria-label=\"Close\" disableRipple\n      (click)=\"serverTimoutDetected = false\">\n      <mat-icon>close</mat-icon>\n    </button>\n    <div class=\"server-error-status\"><h2>Server Timeout Error.</h2></div>\n  </div>\n}\n\n<!--Actions available above the FHIR validator input textarea-->\n<div class=\"row-button-wrapper\">\n\n  <!--Select JSON/XML radio group-->\n  @if (validationInputFormat.format == 'xml and json') {\n    <mat-radio-group [(ngModel)]=\"resourceFormat\" [disabled]=isLoading >\n      <mat-radio-button\n        value=\"json\"\n        [checked]=\"resourceFormat =='json'\"\n        (select)=\"resourceFormat = 'json'\">\n        JSON\n      </mat-radio-button>\n      <mat-radio-button\n        value=\"xml\"\n        [checked]=\"resourceFormat =='xml'\"\n        (select)=\"resourceFormat = 'xml'\">\n        XML\n      </mat-radio-button>\n    </mat-radio-group>\n  }\n\n  @if(igList?.length > 1){\n    <form [formGroup]=\"igSelectionFg\">\n    <mat-form-field appearance=\"outline\" class=\"margin-left-md margin-top-md margin-right-md\">\n      <mat-label>Select IG</mat-label>\n      <mat-select formControlName=\"selectedIgName\">\n        @for (igName of igNameList; track igName) {\n          <mat-option [value]=\"igName\">\n            {{ igName }}\n          </mat-option>\n        }\n      </mat-select>\n      @if (igSelectionFg.invalid) {\n        <mat-error>Select Implementation Guide</mat-error>\n      }\n    </mat-form-field>\n\n    <mat-form-field appearance=\"outline\" class=\"margin-left-md margin-top-md margin-right-md\">\n      <mat-label>Select IG Version</mat-label>\n      <mat-select [disabled]=\"!selectedIgName\" formControlName=\"selectedIgVersion\">\n        @for (igVersion of igVersionDropdownList; track igVersion) {\n          <mat-option [value]=\"igVersion\">\n            {{igVersion}}\n          </mat-option>\n        }\n      </mat-select>\n    </mat-form-field>\n    </form>\n  }\n\n  @if (validationInputFormat?.format == 'xml and json') {\n    <span class=\"content-spacer\"></span>\n  }\n\n  <!--File upload widget-->\n  <input type=\"file\" class=\"file-input\" (click)=\"fileUpload.value=null\"\n    [accept]=\"validationInputFormat?.accepts?.toString()\"\n    (change)=\"onFileSelected($event)\" #fileUpload>\n\n  @if (validationInputFormat.format == 'xml and json') {\n    <span class=\"filename\">{{fileName}}</span>\n  }\n\n  <button mat-raised-button [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\"\n    class=\"upload-btn\"\n    (click)=\"clearUI(); fileUpload.click();\" [disabled]=isLoading>\n    <mat-icon>upload</mat-icon>\n    Upload\n  </button>\n\n  @if (!(validationInputFormat.format == 'xml and json')) {\n    <span class=\"filename\">{{fileName}}</span>\n  }\n</div>\n\n<!-- FHIR validator text editor-->\n<div class=\"textarea-wrapper\">\n  <div class=\"line-numbers\" #numbers>\n    @for (i of getLineNumbers(); track i) {\n      <div class=\"numbers\">{{i}}</div>\n    }\n  </div>\n  <textarea\n    #validatorInput\n    rows=\"30\"\n    [(ngModel)]=\"fhirResource\"\n    (ngModelChange)=\"onResourceContentChanged.emit(fhirResource)\"\n    [ngStyle]=\"{'border-color': (!!validationErrorStr && validationErrorStr != 'Please select an Implementation Guide') ? 'red': null }\"\n    (paste)=\"onPasteFhirResource($event)\"\n    [disabled]=\"isLoading\"\n    (input)=\"lineNumbers()\"\n    (scroll)=\"numbers.scrollTop = validatorInput.scrollTop\"\n    >\n  </textarea>\n</div>\n\n<!--Actions available below the FHIR validator input textarea-->\n@if (formatResourceBtnShown || clearValidatorBtnShown || submitBtnShown || validationErrorStr) {\n  <div class=\"row-button-wrapper\">\n    @if (submitBtnShown && (submitBtnAlignment=='left') && !isLoading) {\n      <span>\n        <button mat-raised-button [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\" class=\"button\"\n          (click)=\"validateFhirResource(fhirResource, resourceFormat)\">\n          <mat-icon>send</mat-icon>\n          Submit\n        </button>\n      </span>\n    }\n    @if (formatResourceBtnShown && !isLoading) {\n      <button [ngClass]=\"{'left-margin-spacer': submitBtnAlignment=='left'}\" mat-raised-button\n        [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\"\n        (click)=\"onFormatInput();\"\n        [disabled]=\"!fhirResource\">\n        <mat-icon>code</mat-icon>\n        Format Input\n      </button>\n    }\n    <span class=\"content-spacer\"></span>\n    @if (validationFinished) {\n      <span id=\"error-response\">\n        @if (!!validationErrorStr && !isValidResource) {\n          <span class=\"danger-color\">{{validationErrorStr}}</span>\n        }\n        @if (isValidResource) {\n          <span class=\"success-color\"> This is a valid FHIR resource.</span>\n        }\n      </span>\n    }\n    <span class=\"content-spacer\"></span>\n    @if (clearValidatorBtnShown && !isLoading) {\n      <button\n        mat-raised-button color=\"success\" class=\"button\"\n        (click)=\"onClear()\">\n        <mat-icon>clear</mat-icon>\n        Clear Validator\n      </button>\n    }\n    @if (submitBtnShown && (submitBtnAlignment =='right') && !isLoading) {\n      <span class=\"left-margin-spacer\">\n        <button mat-raised-button color=\"accent\" class=\"button\"\n          (click)=\"validateFhirResource(fhirResource, resourceFormat)\">\n          <mat-icon>send</mat-icon>\n          {{ submitBtnTitle}}\n        </button>\n      </span>\n    }\n  </div>\n}\n\n@if (isLoading && cancelValidationBtnShown) {\n  <div class=\"row-button-wrapper padding-top-md\">\n    <span class=\"content-spacer\"></span>\n    <button mat-raised-button color=\"warn\" (click)=\"onCancelValidation()\">\n      <mat-icon>cancel</mat-icon>\n      Cancel Validation\n    </button>\n  </div>\n}\n\n<!-- Actions available after validator has processed data-->\n\n@if (apiResponse?.issue && !isLoading) {\n  <div>\n    <div class=\"padding-top-md\">\n      <div (click)=\"onFilterResults()\">\n        <mat-button-toggle-group name=\"severity level filter\" [formControl]=\"severityLevelsFormControl\"\n          aria-label=\"severity level filter\" multiple class=\"full-width\">\n          @for (level of severityLevels; track level) {\n            <mat-button-toggle\n              id=\"format-toggle-buttons\"\n              [value]=\"level\"\n              [disabled]=\"!isFilterEnabled(level)\">\n              <!-- In order to synchronise the state of the button with the state of the checkbox, we simply show or hide\n              selected or deselected checkbox.-->\n              @if (severityLevelsFormControl?.value.indexOf(level) != -1) {\n                <mat-checkbox\n                  color=\"primary\"\n                  [checked]=true\n                  [disabled]=\"!isFilterEnabled(level)\"\n                  [disableRipple]=\"true\"\n                  >\n                </mat-checkbox>\n              }\n              @if (severityLevelsFormControl?.value.indexOf(level) === -1) {\n                <mat-checkbox\n                  color=\"primary\"\n                  [checked]=false\n                  [disabled]=\"!isFilterEnabled(level)\"\n                  [disableRipple]=\"true\"\n                  >\n                </mat-checkbox>\n              }\n              {{level | titlecase }} ({{getCount(level)}})\n            </mat-button-toggle>\n          }\n        </mat-button-toggle-group>\n      </div>\n      @if (validationResultsExpanded) {\n        <div class=\"padding-top-md box\">\n          @if (!resultDetailsExpandBtnShown) {\n            <button mat-raised-button color=primary (click)=\"resultDetailsExpandBtnShown = true\">\n              <mat-icon>expand_more</mat-icon> Expand Validation Results\n            </button>\n          }\n          @if (resultDetailsExpandBtnShown) {\n            <button mat-raised-button color=primary (click)=\"resultDetailsExpandBtnShown = false\">\n              <mat-icon>expand_less</mat-icon> Collapse Validation Results\n            </button>\n          }\n          <span class=\"content-spacer\"></span>\n          @if (exportResultsButtonShown) {\n            <button mat-raised-button (click)=\"exportValidationResults()\" color=\"accent\"\n              [disabled]=\"!(dataSource?.data?.length>0)\">\n              <mat-icon>folder_zip</mat-icon>\n              {{exportValidationResultsBtnName}}\n            </button>\n          }\n        </div>\n      }\n      @if (severityLevelsFormControl?.value?.length === 0) {\n        <div>\n          Please select severity level to see the result.\n        </div>\n      }\n      @if ((!validationResultsExpanded) && exportResultsButtonShown) {\n        <div class=\"padding-top-md box margin-bottom-md\">\n          <button mat-raised-button (click)=\"exportValidationResults()\" color=\"accent\"\n            [disabled]=\"!(dataSource?.data?.length>0)\" class=\"margin-left-md\">\n            <mat-icon>folder_zip</mat-icon>\n            {{exportValidationResultsBtnName}}\n          </button>\n        </div>\n      }\n      @if (severityLevelsFormControl?.value?.length > 0 && resultDetailsExpandBtnShown) {\n        <table\n          mat-table [dataSource]=\"dataSource\" multiTemplateDataRows\n          >\n          <!-- First column contains expand/collapse widget. The user can chose to expand/collapse all rows,\n          as well as expand/collapse individual rows. Note that the expand/collapse all can be toggled automatically\n          based the state of the individual expand/collapse rows. For example if all rows are expanded and \"expand all\"\n          is rendered, we automatically hide it end render \"collapse all\" -->\n          <ng-container matColumnDef=\"toggle\">\n            <th mat-header-cell *matHeaderCellDef (click)=\"toggle()\">\n              @if (!allExpanded) {\n                <mat-icon class=\"pointer\" matTooltip=\"Expand All\" aria-label=\"expand all\">\n                  expand_more\n                </mat-icon>\n              }\n              @if (allExpanded) {\n                <mat-icon class=\"pointer\" matTooltip=\"Collapse All\" aria-label=\"collapse all\">\n                  expand_less\n                </mat-icon>\n              }\n            </th>\n            <td mat-cell *matCellDef=\"let validationResultItem\" class=\"pointer\"\n              (click)=\"validationResultItem.expanded = !validationResultItem.expanded; checkExpandCollapseAllStatus()\">\n              @if (!validationResultItem.expanded) {\n                <mat-icon aria-label=\"expand\">\n                  expand_more\n                </mat-icon>\n              }\n              @if (validationResultItem.expanded) {\n                <mat-icon aria-label=\"collapse\">\n                  expand_less\n                </mat-icon>\n              }\n            </td>\n          </ng-container>\n          <!-- Severity level icons -->\n          <ng-container matColumnDef=\"icon\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              @if (validationResultItem.severity === 'Error') {\n                <mat-icon\n                  class=\"danger-color\">error\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Warning') {\n                <mat-icon\n                  class=\"warning-color\">warning\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Information') {\n                <mat-icon\n                  class=\"success-color\">info\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Note') {\n                <mat-icon\n                  class=\"md-primary-color\">edit_note\n                </mat-icon>\n              }\n            </td>\n          </ng-container>\n          <!-- Severity level string -->\n          <ng-container matColumnDef=\"severity\">\n            <th mat-header-cell *matHeaderCellDef>Severity</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              {{validationResultItem.severity}}\n            </td>\n          </ng-container>\n          <!-- Severity level string -->\n          <ng-container matColumnDef=\"fhirPath\">\n            <th mat-header-cell *matHeaderCellDef>FHIR path</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              {{validationResultItem?.expression?.[0]}}\n            </td>\n          </ng-container>\n          <!-- The location as returned by the server. Note that the resource returned by the  response could be\n          formatted differently then the request resource. What this means is the the line numbers in the response\n          resource many not match those in the request.-->\n          <ng-container matColumnDef=\"location\">\n            <th mat-header-cell *matHeaderCellDef id=\"location-column-header\"> Location</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\" (click)=\"onLocationSelected(validationResultItem)\">\n              <span class=\"location-data\"> {{validationResultItem.location}}</span>\n            </td>\n          </ng-container>\n          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n          <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let validationResultItem\" [attr.colspan]=\"displayedColumns?.length\">\n              <div class=\"validation-result-detail\"\n                [@detailExpand]=\"validationResultItem.expanded ? 'expanded' : 'collapsed'\">\n                <div class=\"validation-result-text-value\">\n                  {{validationResultItem.diagnostics}}\n                </div>\n              </div>\n            </td>\n          </ng-container>\n          <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n          <tr mat-row *matRowDef=\"let validationResultItem; columns: displayedColumns;\"\n            class=\"table-row\"\n            [class.expanded-row]=\"validationResultItem.expanded\">\n            <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"text-value-row\"></tr>\n          </table>\n        }\n      </div>\n      <!-- Resource as returned from the validator. Note that the resource returned from the validator may be\n      formatted differently then the resource we sent to the validator. -->\n      @if (resultDetailsExpandBtnShown && apiResponse?.formattedResource) {\n        <div class=\"padding-top-md\">\n          <div class=\"line-numbers-response\" #numbers>\n            @for (item of apiResponse?.formattedResource?.split('\\n'); track item; let i = $index) {\n              <div class=\"numbers-response\">{{i + 1}}</div>\n            }\n          </div>\n          <div class=\"validator-response\">\n            @for (item of apiResponse?.formattedResource?.split('\\n'); track item; let i = $index) {\n              <span>\n                <pre [ngClass]=\"getLineItemClass(item, i)\" class=\"line-item\" [id]=\"'mark'+ (i+1)\">{{item}}</pre>\n              </span>\n            }\n          </div>\n        </div>\n      }\n    </div>\n  }\n", styles: [".margin-sm{margin:8px}.margin-md{margin:16px}.margin-lg{margin:24px}.padding-xs{padding:4px}.padding-sm{padding:8px}.padding-md{padding:16px}.padding-lg{padding:24px}.margin-bottom-xs{margin-bottom:4px}.margin-bottom-sm{margin-bottom:8px}.margin-bottom-md{margin-bottom:16px}.margin-top-xs{margin-top:4px}.margin-top-sm{margin-top:8px}.margin-top-md{margin-top:16px}.margin-left-md{margin-left:16px}.margin-right-md{margin-right:16px}.padding-top-md{padding-top:16px}.padding-bottom-md{padding-bottom:16px}.padding-left-md{padding-left:16px}.padding-right-md{padding-right:16px}.border-radius-xs{border-radius:4px}textarea{display:inline-block;border-color:#ccc;font-size:13px;line-height:16px;width:95%;padding-left:36px;height:50vh;white-space:nowrap;resize:none}.textarea-wrapper{margin-top:10px}.line-numbers{display:inline-block;position:absolute;text-align:-webkit-center;font-family:monospace;width:36px;line-height:16px;padding-top:3px;height:50.2vh;overflow:hidden;background:#0000001a;border-radius:3px}.box{display:flex}.line-numbers-response{display:inline-block;position:absolute;text-align:-webkit-center;font-family:monospace;width:36px;line-height:16px;overflow:hidden;background:#e8e8e8;border-radius:3px}.numbers{font-size:13px}.validator-response{font-size:13px;line-height:16px;margin-left:36px;width:96%;font-family:monospace;background-color:#f8f8f8;overflow-x:scroll}.mat-radio-button{margin-right:16px;margin-bottom:10px}.file-input{display:none}.close-icon{float:right;color:#5f6368}#spaced-content{display:flex;flex-flow:row wrap}pre{white-space:pre-wrap}td.mat-cell{font-size:13px;font-family:monospace}.location-data{cursor:pointer;color:#3f51b5}.spinner-container{position:absolute;height:100px;width:100px;top:40%;left:50%;margin-left:-50px;margin-top:-50px}td,th{white-space:normal;word-wrap:break-word}#location-column-header{min-width:200px}#severity-column-header{min-width:300px}.left-margin-spacer{margin-left:16px}#error-response{font-size:large;font-weight:700}#validator-title{padding-left:0}table{width:100%}tr.text-value-row{height:0}.validation-result-row td{border-bottom-width:0}.validation-result-detail{overflow:hidden;display:flex}.validation-result-text-value{padding:16px}.expanded-row{background-color:#fafaff}.table-row{font-weight:700}.mat-button-toggle-checked{color:#303f9f;background-color:#e8eaf6;border:1px solid #7986cb}.row-button-wrapper{display:flex;align-items:center}mat-button-toggle{font-weight:700}.mat-button-toggle-disabled{background-color:#f5f5f5;color:#252525;border:1px solid whitesmoke}.mat-column-toggle,.mat-column-icon{width:5%!important}.mat-column-severity{width:10%!important}.mat-column-fhirPath{width:70%!important}.mat-column-location{width:10%!important}.close-button{float:right;right:-8px}.server-error-message-container{border-style:solid;border-width:1px;margin-top:16px;margin-bottom:16px;border-color:#d32f2f}.server-error-status{color:#d32f2f;margin-left:1em;margin-top:1em}.server-error-message-text{margin-left:16px;margin-bottom:16px;font-family:monospace}.filename{font-family:monospace;margin:0 16px}#format-toggle-buttons{width:25%}.content-spacer{flex:1 1 auto}.full-width{width:100%}.warning-mark{background-color:#fff2cc}.error-mark{background-color:#fcc}.info-mark{background-color:#dcedc8}.note-mark{background-color:#e3f2fd}.success-color{color:#28a745}.danger-color{color:#dc3549}.warning-color{color:#ffc107}.line-item{margin:0;white-space:pre}.right-aligned{display:flex;flex-direction:column;align-items:flex-end}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "component", type: i3.MatFormField, selector: "mat-form-field", inputs: ["hideRequiredMarker", "color", "floatLabel", "appearance", "subscriptSizing", "hintLabel"], exportAs: ["matFormField"] }, { kind: "directive", type: i3.MatLabel, selector: "mat-label" }, { kind: "directive", type: i3.MatError, selector: "mat-error, [matError]", inputs: ["id"] }, { kind: "component", type: i4.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", exportAs: ["matButton"] }, { kind: "directive", type: i5.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i5.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i5.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i5.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i5.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i5.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i5.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "component", type: i7.MatTable, selector: "mat-table, table[mat-table]", exportAs: ["matTable"] }, { kind: "directive", type: i7.MatHeaderCellDef, selector: "[matHeaderCellDef]" }, { kind: "directive", type: i7.MatHeaderRowDef, selector: "[matHeaderRowDef]", inputs: ["matHeaderRowDef", "matHeaderRowDefSticky"] }, { kind: "directive", type: i7.MatColumnDef, selector: "[matColumnDef]", inputs: ["matColumnDef"] }, { kind: "directive", type: i7.MatCellDef, selector: "[matCellDef]" }, { kind: "directive", type: i7.MatRowDef, selector: "[matRowDef]", inputs: ["matRowDefColumns", "matRowDefWhen"] }, { kind: "directive", type: i7.MatHeaderCell, selector: "mat-header-cell, th[mat-header-cell]" }, { kind: "directive", type: i7.MatCell, selector: "mat-cell, td[mat-cell]" }, { kind: "component", type: i7.MatHeaderRow, selector: "mat-header-row, tr[mat-header-row]", exportAs: ["matHeaderRow"] }, { kind: "component", type: i7.MatRow, selector: "mat-row, tr[mat-row]", exportAs: ["matRow"] }, { kind: "component", type: i8.MatProgressSpinner, selector: "mat-progress-spinner, mat-spinner", inputs: ["color", "mode", "value", "diameter", "strokeWidth"], exportAs: ["matProgressSpinner"] }, { kind: "directive", type: i9.MatRadioGroup, selector: "mat-radio-group", inputs: ["color", "name", "labelPosition", "value", "selected", "disabled", "required"], outputs: ["change"], exportAs: ["matRadioGroup"] }, { kind: "component", type: i9.MatRadioButton, selector: "mat-radio-button", inputs: ["id", "name", "aria-label", "aria-labelledby", "aria-describedby", "disableRipple", "tabIndex", "checked", "value", "labelPosition", "disabled", "required", "color"], outputs: ["change"], exportAs: ["matRadioButton"] }, { kind: "directive", type: i5.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i10.MatCardHeader, selector: "mat-card-header" }, { kind: "directive", type: i10.MatCardTitle, selector: "mat-card-title, [mat-card-title], [matCardTitle]" }, { kind: "component", type: i11.MatSelect, selector: "mat-select", inputs: ["aria-describedby", "panelClass", "disabled", "disableRipple", "tabIndex", "hideSingleSelectionIndicator", "placeholder", "required", "multiple", "disableOptionCentering", "compareWith", "value", "aria-label", "aria-labelledby", "errorStateMatcher", "typeaheadDebounceInterval", "sortComparator", "id", "panelWidth"], outputs: ["openedChange", "opened", "closed", "selectionChange", "valueChange"], exportAs: ["matSelect"] }, { kind: "component", type: i12.MatOption, selector: "mat-option", inputs: ["value", "id", "disabled"], outputs: ["onSelectionChange"], exportAs: ["matOption"] }, { kind: "directive", type: i13.MatButtonToggleGroup, selector: "mat-button-toggle-group", inputs: ["appearance", "name", "vertical", "value", "multiple", "disabled", "hideSingleSelectionIndicator", "hideMultipleSelectionIndicator"], outputs: ["valueChange", "change"], exportAs: ["matButtonToggleGroup"] }, { kind: "component", type: i13.MatButtonToggle, selector: "mat-button-toggle", inputs: ["aria-label", "aria-labelledby", "id", "name", "value", "tabIndex", "disableRipple", "appearance", "checked", "disabled"], outputs: ["change"], exportAs: ["matButtonToggle"] }, { kind: "component", type: i14.MatCheckbox, selector: "mat-checkbox", inputs: ["aria-label", "aria-labelledby", "aria-describedby", "id", "required", "labelPosition", "name", "value", "disableRipple", "tabIndex", "color", "checked", "disabled", "indeterminate"], outputs: ["change", "indeterminateChange"], exportAs: ["matCheckbox"] }, { kind: "directive", type: i15.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "pipe", type: i2.TitleCasePipe, name: "titlecase" }], animations: [
            trigger('detailExpand', [
                state('collapsed', style({ height: '0px', minHeight: '0' })),
                state('expanded', style({ height: '*' })),
                transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
            ]),
        ] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.0", ngImport: i0, type: NgxFhirValidatorComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-ngx-fhir-validator', animations: [
                        trigger('detailExpand', [
                            state('collapsed', style({ height: '0px', minHeight: '0' })),
                            state('expanded', style({ height: '*' })),
                            transition('expanded <=> collapsed', animate('225ms cubic-bezier(0.4, 0.0, 0.2, 1)')),
                        ]),
                    ], template: "@if (isLoading) {\n  <div class=\"spinner-container\">\n    <mat-spinner></mat-spinner>\n  </div>\n}\n\n@if (validatorTitle) {\n  <mat-card-header  id=\"validator-title\">\n    <mat-card-title>{{ validatorTitle }}</mat-card-title>\n  </mat-card-header>\n}\n\n\n<!-- The section below renders error messages returned by the validator.-->\n@if (serverErrorDetected) {\n  <div class=server-error-message-container>\n    <button mat-button class=\"close-button\" color=\"accent\" aria-label=\"Close\" disableRipple\n      (click)=\"onCloseServerErrorMessage()\">\n      <mat-icon>close</mat-icon>\n    </button>\n    <div class=\"server-error-status\"><h2>Server Error Response Status: {{ serverErrorStatus }}</h2></div>\n    @for (serverError of serverErrorList; track serverError) {\n      <div class=\"server-error-message-text\"\n      [innerText]=\"serverError.diagnostics\"></div>\n    }\n  </div>\n}\n\n<!-- TODO remove this code when the API code is updated to return 408 on request timeout -->\n@if (serverTimoutDetected) {\n  <div class=server-error-message-container>\n    <button mat-button class=\"close-button\" color=\"accent\" aria-label=\"Close\" disableRipple\n      (click)=\"serverTimoutDetected = false\">\n      <mat-icon>close</mat-icon>\n    </button>\n    <div class=\"server-error-status\"><h2>Server Timeout Error.</h2></div>\n  </div>\n}\n\n<!--Actions available above the FHIR validator input textarea-->\n<div class=\"row-button-wrapper\">\n\n  <!--Select JSON/XML radio group-->\n  @if (validationInputFormat.format == 'xml and json') {\n    <mat-radio-group [(ngModel)]=\"resourceFormat\" [disabled]=isLoading >\n      <mat-radio-button\n        value=\"json\"\n        [checked]=\"resourceFormat =='json'\"\n        (select)=\"resourceFormat = 'json'\">\n        JSON\n      </mat-radio-button>\n      <mat-radio-button\n        value=\"xml\"\n        [checked]=\"resourceFormat =='xml'\"\n        (select)=\"resourceFormat = 'xml'\">\n        XML\n      </mat-radio-button>\n    </mat-radio-group>\n  }\n\n  @if(igList?.length > 1){\n    <form [formGroup]=\"igSelectionFg\">\n    <mat-form-field appearance=\"outline\" class=\"margin-left-md margin-top-md margin-right-md\">\n      <mat-label>Select IG</mat-label>\n      <mat-select formControlName=\"selectedIgName\">\n        @for (igName of igNameList; track igName) {\n          <mat-option [value]=\"igName\">\n            {{ igName }}\n          </mat-option>\n        }\n      </mat-select>\n      @if (igSelectionFg.invalid) {\n        <mat-error>Select Implementation Guide</mat-error>\n      }\n    </mat-form-field>\n\n    <mat-form-field appearance=\"outline\" class=\"margin-left-md margin-top-md margin-right-md\">\n      <mat-label>Select IG Version</mat-label>\n      <mat-select [disabled]=\"!selectedIgName\" formControlName=\"selectedIgVersion\">\n        @for (igVersion of igVersionDropdownList; track igVersion) {\n          <mat-option [value]=\"igVersion\">\n            {{igVersion}}\n          </mat-option>\n        }\n      </mat-select>\n    </mat-form-field>\n    </form>\n  }\n\n  @if (validationInputFormat?.format == 'xml and json') {\n    <span class=\"content-spacer\"></span>\n  }\n\n  <!--File upload widget-->\n  <input type=\"file\" class=\"file-input\" (click)=\"fileUpload.value=null\"\n    [accept]=\"validationInputFormat?.accepts?.toString()\"\n    (change)=\"onFileSelected($event)\" #fileUpload>\n\n  @if (validationInputFormat.format == 'xml and json') {\n    <span class=\"filename\">{{fileName}}</span>\n  }\n\n  <button mat-raised-button [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\"\n    class=\"upload-btn\"\n    (click)=\"clearUI(); fileUpload.click();\" [disabled]=isLoading>\n    <mat-icon>upload</mat-icon>\n    Upload\n  </button>\n\n  @if (!(validationInputFormat.format == 'xml and json')) {\n    <span class=\"filename\">{{fileName}}</span>\n  }\n</div>\n\n<!-- FHIR validator text editor-->\n<div class=\"textarea-wrapper\">\n  <div class=\"line-numbers\" #numbers>\n    @for (i of getLineNumbers(); track i) {\n      <div class=\"numbers\">{{i}}</div>\n    }\n  </div>\n  <textarea\n    #validatorInput\n    rows=\"30\"\n    [(ngModel)]=\"fhirResource\"\n    (ngModelChange)=\"onResourceContentChanged.emit(fhirResource)\"\n    [ngStyle]=\"{'border-color': (!!validationErrorStr && validationErrorStr != 'Please select an Implementation Guide') ? 'red': null }\"\n    (paste)=\"onPasteFhirResource($event)\"\n    [disabled]=\"isLoading\"\n    (input)=\"lineNumbers()\"\n    (scroll)=\"numbers.scrollTop = validatorInput.scrollTop\"\n    >\n  </textarea>\n</div>\n\n<!--Actions available below the FHIR validator input textarea-->\n@if (formatResourceBtnShown || clearValidatorBtnShown || submitBtnShown || validationErrorStr) {\n  <div class=\"row-button-wrapper\">\n    @if (submitBtnShown && (submitBtnAlignment=='left') && !isLoading) {\n      <span>\n        <button mat-raised-button [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\" class=\"button\"\n          (click)=\"validateFhirResource(fhirResource, resourceFormat)\">\n          <mat-icon>send</mat-icon>\n          Submit\n        </button>\n      </span>\n    }\n    @if (formatResourceBtnShown && !isLoading) {\n      <button [ngClass]=\"{'left-margin-spacer': submitBtnAlignment=='left'}\" mat-raised-button\n        [style.background-color]=\"buttonBackgroundColor\" [style.color]=\"buttonTxtColor\"\n        (click)=\"onFormatInput();\"\n        [disabled]=\"!fhirResource\">\n        <mat-icon>code</mat-icon>\n        Format Input\n      </button>\n    }\n    <span class=\"content-spacer\"></span>\n    @if (validationFinished) {\n      <span id=\"error-response\">\n        @if (!!validationErrorStr && !isValidResource) {\n          <span class=\"danger-color\">{{validationErrorStr}}</span>\n        }\n        @if (isValidResource) {\n          <span class=\"success-color\"> This is a valid FHIR resource.</span>\n        }\n      </span>\n    }\n    <span class=\"content-spacer\"></span>\n    @if (clearValidatorBtnShown && !isLoading) {\n      <button\n        mat-raised-button color=\"success\" class=\"button\"\n        (click)=\"onClear()\">\n        <mat-icon>clear</mat-icon>\n        Clear Validator\n      </button>\n    }\n    @if (submitBtnShown && (submitBtnAlignment =='right') && !isLoading) {\n      <span class=\"left-margin-spacer\">\n        <button mat-raised-button color=\"accent\" class=\"button\"\n          (click)=\"validateFhirResource(fhirResource, resourceFormat)\">\n          <mat-icon>send</mat-icon>\n          {{ submitBtnTitle}}\n        </button>\n      </span>\n    }\n  </div>\n}\n\n@if (isLoading && cancelValidationBtnShown) {\n  <div class=\"row-button-wrapper padding-top-md\">\n    <span class=\"content-spacer\"></span>\n    <button mat-raised-button color=\"warn\" (click)=\"onCancelValidation()\">\n      <mat-icon>cancel</mat-icon>\n      Cancel Validation\n    </button>\n  </div>\n}\n\n<!-- Actions available after validator has processed data-->\n\n@if (apiResponse?.issue && !isLoading) {\n  <div>\n    <div class=\"padding-top-md\">\n      <div (click)=\"onFilterResults()\">\n        <mat-button-toggle-group name=\"severity level filter\" [formControl]=\"severityLevelsFormControl\"\n          aria-label=\"severity level filter\" multiple class=\"full-width\">\n          @for (level of severityLevels; track level) {\n            <mat-button-toggle\n              id=\"format-toggle-buttons\"\n              [value]=\"level\"\n              [disabled]=\"!isFilterEnabled(level)\">\n              <!-- In order to synchronise the state of the button with the state of the checkbox, we simply show or hide\n              selected or deselected checkbox.-->\n              @if (severityLevelsFormControl?.value.indexOf(level) != -1) {\n                <mat-checkbox\n                  color=\"primary\"\n                  [checked]=true\n                  [disabled]=\"!isFilterEnabled(level)\"\n                  [disableRipple]=\"true\"\n                  >\n                </mat-checkbox>\n              }\n              @if (severityLevelsFormControl?.value.indexOf(level) === -1) {\n                <mat-checkbox\n                  color=\"primary\"\n                  [checked]=false\n                  [disabled]=\"!isFilterEnabled(level)\"\n                  [disableRipple]=\"true\"\n                  >\n                </mat-checkbox>\n              }\n              {{level | titlecase }} ({{getCount(level)}})\n            </mat-button-toggle>\n          }\n        </mat-button-toggle-group>\n      </div>\n      @if (validationResultsExpanded) {\n        <div class=\"padding-top-md box\">\n          @if (!resultDetailsExpandBtnShown) {\n            <button mat-raised-button color=primary (click)=\"resultDetailsExpandBtnShown = true\">\n              <mat-icon>expand_more</mat-icon> Expand Validation Results\n            </button>\n          }\n          @if (resultDetailsExpandBtnShown) {\n            <button mat-raised-button color=primary (click)=\"resultDetailsExpandBtnShown = false\">\n              <mat-icon>expand_less</mat-icon> Collapse Validation Results\n            </button>\n          }\n          <span class=\"content-spacer\"></span>\n          @if (exportResultsButtonShown) {\n            <button mat-raised-button (click)=\"exportValidationResults()\" color=\"accent\"\n              [disabled]=\"!(dataSource?.data?.length>0)\">\n              <mat-icon>folder_zip</mat-icon>\n              {{exportValidationResultsBtnName}}\n            </button>\n          }\n        </div>\n      }\n      @if (severityLevelsFormControl?.value?.length === 0) {\n        <div>\n          Please select severity level to see the result.\n        </div>\n      }\n      @if ((!validationResultsExpanded) && exportResultsButtonShown) {\n        <div class=\"padding-top-md box margin-bottom-md\">\n          <button mat-raised-button (click)=\"exportValidationResults()\" color=\"accent\"\n            [disabled]=\"!(dataSource?.data?.length>0)\" class=\"margin-left-md\">\n            <mat-icon>folder_zip</mat-icon>\n            {{exportValidationResultsBtnName}}\n          </button>\n        </div>\n      }\n      @if (severityLevelsFormControl?.value?.length > 0 && resultDetailsExpandBtnShown) {\n        <table\n          mat-table [dataSource]=\"dataSource\" multiTemplateDataRows\n          >\n          <!-- First column contains expand/collapse widget. The user can chose to expand/collapse all rows,\n          as well as expand/collapse individual rows. Note that the expand/collapse all can be toggled automatically\n          based the state of the individual expand/collapse rows. For example if all rows are expanded and \"expand all\"\n          is rendered, we automatically hide it end render \"collapse all\" -->\n          <ng-container matColumnDef=\"toggle\">\n            <th mat-header-cell *matHeaderCellDef (click)=\"toggle()\">\n              @if (!allExpanded) {\n                <mat-icon class=\"pointer\" matTooltip=\"Expand All\" aria-label=\"expand all\">\n                  expand_more\n                </mat-icon>\n              }\n              @if (allExpanded) {\n                <mat-icon class=\"pointer\" matTooltip=\"Collapse All\" aria-label=\"collapse all\">\n                  expand_less\n                </mat-icon>\n              }\n            </th>\n            <td mat-cell *matCellDef=\"let validationResultItem\" class=\"pointer\"\n              (click)=\"validationResultItem.expanded = !validationResultItem.expanded; checkExpandCollapseAllStatus()\">\n              @if (!validationResultItem.expanded) {\n                <mat-icon aria-label=\"expand\">\n                  expand_more\n                </mat-icon>\n              }\n              @if (validationResultItem.expanded) {\n                <mat-icon aria-label=\"collapse\">\n                  expand_less\n                </mat-icon>\n              }\n            </td>\n          </ng-container>\n          <!-- Severity level icons -->\n          <ng-container matColumnDef=\"icon\">\n            <th mat-header-cell *matHeaderCellDef></th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              @if (validationResultItem.severity === 'Error') {\n                <mat-icon\n                  class=\"danger-color\">error\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Warning') {\n                <mat-icon\n                  class=\"warning-color\">warning\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Information') {\n                <mat-icon\n                  class=\"success-color\">info\n                </mat-icon>\n              }\n              @if (validationResultItem.severity === 'Note') {\n                <mat-icon\n                  class=\"md-primary-color\">edit_note\n                </mat-icon>\n              }\n            </td>\n          </ng-container>\n          <!-- Severity level string -->\n          <ng-container matColumnDef=\"severity\">\n            <th mat-header-cell *matHeaderCellDef>Severity</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              {{validationResultItem.severity}}\n            </td>\n          </ng-container>\n          <!-- Severity level string -->\n          <ng-container matColumnDef=\"fhirPath\">\n            <th mat-header-cell *matHeaderCellDef>FHIR path</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\">\n              {{validationResultItem?.expression?.[0]}}\n            </td>\n          </ng-container>\n          <!-- The location as returned by the server. Note that the resource returned by the  response could be\n          formatted differently then the request resource. What this means is the the line numbers in the response\n          resource many not match those in the request.-->\n          <ng-container matColumnDef=\"location\">\n            <th mat-header-cell *matHeaderCellDef id=\"location-column-header\"> Location</th>\n            <td mat-cell *matCellDef=\"let validationResultItem\" (click)=\"onLocationSelected(validationResultItem)\">\n              <span class=\"location-data\"> {{validationResultItem.location}}</span>\n            </td>\n          </ng-container>\n          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->\n          <ng-container matColumnDef=\"expandedDetail\">\n            <td mat-cell *matCellDef=\"let validationResultItem\" [attr.colspan]=\"displayedColumns?.length\">\n              <div class=\"validation-result-detail\"\n                [@detailExpand]=\"validationResultItem.expanded ? 'expanded' : 'collapsed'\">\n                <div class=\"validation-result-text-value\">\n                  {{validationResultItem.diagnostics}}\n                </div>\n              </div>\n            </td>\n          </ng-container>\n          <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n          <tr mat-row *matRowDef=\"let validationResultItem; columns: displayedColumns;\"\n            class=\"table-row\"\n            [class.expanded-row]=\"validationResultItem.expanded\">\n            <tr mat-row *matRowDef=\"let row; columns: ['expandedDetail']\" class=\"text-value-row\"></tr>\n          </table>\n        }\n      </div>\n      <!-- Resource as returned from the validator. Note that the resource returned from the validator may be\n      formatted differently then the resource we sent to the validator. -->\n      @if (resultDetailsExpandBtnShown && apiResponse?.formattedResource) {\n        <div class=\"padding-top-md\">\n          <div class=\"line-numbers-response\" #numbers>\n            @for (item of apiResponse?.formattedResource?.split('\\n'); track item; let i = $index) {\n              <div class=\"numbers-response\">{{i + 1}}</div>\n            }\n          </div>\n          <div class=\"validator-response\">\n            @for (item of apiResponse?.formattedResource?.split('\\n'); track item; let i = $index) {\n              <span>\n                <pre [ngClass]=\"getLineItemClass(item, i)\" class=\"line-item\" [id]=\"'mark'+ (i+1)\">{{item}}</pre>\n              </span>\n            }\n          </div>\n        </div>\n      }\n    </div>\n  }\n", styles: [".margin-sm{margin:8px}.margin-md{margin:16px}.margin-lg{margin:24px}.padding-xs{padding:4px}.padding-sm{padding:8px}.padding-md{padding:16px}.padding-lg{padding:24px}.margin-bottom-xs{margin-bottom:4px}.margin-bottom-sm{margin-bottom:8px}.margin-bottom-md{margin-bottom:16px}.margin-top-xs{margin-top:4px}.margin-top-sm{margin-top:8px}.margin-top-md{margin-top:16px}.margin-left-md{margin-left:16px}.margin-right-md{margin-right:16px}.padding-top-md{padding-top:16px}.padding-bottom-md{padding-bottom:16px}.padding-left-md{padding-left:16px}.padding-right-md{padding-right:16px}.border-radius-xs{border-radius:4px}textarea{display:inline-block;border-color:#ccc;font-size:13px;line-height:16px;width:95%;padding-left:36px;height:50vh;white-space:nowrap;resize:none}.textarea-wrapper{margin-top:10px}.line-numbers{display:inline-block;position:absolute;text-align:-webkit-center;font-family:monospace;width:36px;line-height:16px;padding-top:3px;height:50.2vh;overflow:hidden;background:#0000001a;border-radius:3px}.box{display:flex}.line-numbers-response{display:inline-block;position:absolute;text-align:-webkit-center;font-family:monospace;width:36px;line-height:16px;overflow:hidden;background:#e8e8e8;border-radius:3px}.numbers{font-size:13px}.validator-response{font-size:13px;line-height:16px;margin-left:36px;width:96%;font-family:monospace;background-color:#f8f8f8;overflow-x:scroll}.mat-radio-button{margin-right:16px;margin-bottom:10px}.file-input{display:none}.close-icon{float:right;color:#5f6368}#spaced-content{display:flex;flex-flow:row wrap}pre{white-space:pre-wrap}td.mat-cell{font-size:13px;font-family:monospace}.location-data{cursor:pointer;color:#3f51b5}.spinner-container{position:absolute;height:100px;width:100px;top:40%;left:50%;margin-left:-50px;margin-top:-50px}td,th{white-space:normal;word-wrap:break-word}#location-column-header{min-width:200px}#severity-column-header{min-width:300px}.left-margin-spacer{margin-left:16px}#error-response{font-size:large;font-weight:700}#validator-title{padding-left:0}table{width:100%}tr.text-value-row{height:0}.validation-result-row td{border-bottom-width:0}.validation-result-detail{overflow:hidden;display:flex}.validation-result-text-value{padding:16px}.expanded-row{background-color:#fafaff}.table-row{font-weight:700}.mat-button-toggle-checked{color:#303f9f;background-color:#e8eaf6;border:1px solid #7986cb}.row-button-wrapper{display:flex;align-items:center}mat-button-toggle{font-weight:700}.mat-button-toggle-disabled{background-color:#f5f5f5;color:#252525;border:1px solid whitesmoke}.mat-column-toggle,.mat-column-icon{width:5%!important}.mat-column-severity{width:10%!important}.mat-column-fhirPath{width:70%!important}.mat-column-location{width:10%!important}.close-button{float:right;right:-8px}.server-error-message-container{border-style:solid;border-width:1px;margin-top:16px;margin-bottom:16px;border-color:#d32f2f}.server-error-status{color:#d32f2f;margin-left:1em;margin-top:1em}.server-error-message-text{margin-left:16px;margin-bottom:16px;font-family:monospace}.filename{font-family:monospace;margin:0 16px}#format-toggle-buttons{width:25%}.content-spacer{flex:1 1 auto}.full-width{width:100%}.warning-mark{background-color:#fff2cc}.error-mark{background-color:#fcc}.info-mark{background-color:#dcedc8}.note-mark{background-color:#e3f2fd}.success-color{color:#28a745}.danger-color{color:#dc3549}.warning-color{color:#ffc107}.line-item{margin:0;white-space:pre}.right-aligned{display:flex;flex-direction:column;align-items:flex-end}\n"] }]
        }], ctorParameters: () => [{ type: i1.FhirValidatorService }], propDecorators: { validatorTitle: [{
                type: Input
            }], validationResultsExpanded: [{
                type: Input
            }], resultDetailsExpandBtnShown: [{
                type: Input
            }], formatResourceBtnShown: [{
                type: Input
            }], clearValidatorBtnShown: [{
                type: Input
            }], submitBtnShown: [{
                type: Input
            }], exportResultsButtonShown: [{
                type: Input
            }], submitBtnTitle: [{
                type: Input
            }], validationInputFormat: [{
                type: Input
            }], maxFileSize: [{
                type: Input
            }], submitBtnAlignment: [{
                type: Input
            }], cancelValidationBtnShown: [{
                type: Input
            }], buttonTxtColor: [{
                type: Input
            }], buttonBackgroundColor: [{
                type: Input
            }], exportValidationResultsBtnName: [{
                type: Input
            }], onValidation: [{
                type: Output
            }], onApiError: [{
                type: Output
            }], onResourceContentChanged: [{
                type: Output
            }], onExportValidationResults: [{
                type: Output
            }], ig: [{
                type: Input
            }], inputRef: [{
                type: ViewChild,
                args: ['validatorInput', { static: false, read: ElementRef }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZoaXItdmFsaWRhdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1maGlyLXZhbGlkYXRvci9zcmMvbGliL2NvbXBvbmVudHMvbmd4LWZoaXItdmFsaWRhdG9yLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1maGlyLXZhbGlkYXRvci9zcmMvbGliL2NvbXBvbmVudHMvbmd4LWZoaXItdmFsaWRhdG9yLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxrQ0FBa0MsQ0FBQztBQUNwRSxPQUFPLEVBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxVQUFVLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUkzRCxPQUFPLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBQyxNQUFNLHFCQUFxQixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7OztBQW9CL0UsTUFBTSxPQUFPLHlCQUF5QjtJQTREcEMsWUFDVSxvQkFBMEM7UUFBMUMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQTVEM0MsbUJBQWMsR0FBVyxFQUFFLENBQUM7UUFDNUIsOEJBQXlCLEdBQVksS0FBSyxDQUFDLENBQUMsMkNBQTJDO1FBQ3ZGLGdDQUEyQixHQUFZLElBQUksQ0FBQyxDQUFDLDBDQUEwQztRQUN2RiwyQkFBc0IsR0FBWSxLQUFLLENBQUMsQ0FBQyxnQ0FBZ0M7UUFDekUsMkJBQXNCLEdBQVksSUFBSSxDQUFDLENBQUMsZ0NBQWdDO1FBQ3hFLG1CQUFjLEdBQVksSUFBSSxDQUFDLENBQUMsdUJBQXVCO1FBQ3ZELDZCQUF3QixHQUFHLElBQUksQ0FBQztRQUNoQyxtQkFBYyxHQUFXLFFBQVEsQ0FBQyxDQUFDLHdGQUF3RjtRQUMzSCwwQkFBcUIsR0FBbUIsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUMsQ0FBQztRQUMzRSxnQkFBVyxHQUFHLE1BQU0sQ0FBQSxDQUFDLGlDQUFpQztRQUN0RCx1QkFBa0IsR0FBMEIsT0FBTyxDQUFDLENBQUMsMENBQTBDO1FBQy9GLDZCQUF3QixHQUFZLElBQUksQ0FBQztRQUN6QyxtQkFBYyxHQUFZLE9BQU8sQ0FBQztRQUNsQywwQkFBcUIsR0FBQyxTQUFTLENBQUM7UUFDaEMsbUNBQThCLEdBQVcsdUJBQXVCLENBQUM7UUFFaEUsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBcUIsQ0FBQztRQUNyRCxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUNyQyw2QkFBd0IsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ25ELDhCQUF5QixHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFPOUQsaUJBQVksR0FBVyxFQUFFLENBQUEsQ0FBQSxnQkFBZ0I7UUFDekMsbUJBQWMsR0FBRyxNQUFNLENBQUMsQ0FBQyxnRkFBZ0Y7UUFDekcsYUFBUSxHQUFXLEVBQUUsQ0FBQyxDQUFDLHdGQUF3RjtRQUMvRyx1QkFBa0IsR0FBVyxFQUFFLENBQUMsQ0FBQyxvRkFBb0Y7UUFDckgsb0JBQWUsR0FBRyxLQUFLLENBQUMsQ0FBRSxrRkFBa0Y7UUFDNUcsdUJBQWtCLEdBQVcsRUFBRSxDQUFDLENBQUMsNkVBQTZFO1FBRTlHLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIsZ0JBQVcsR0FBRyxJQUFJLENBQUMsQ0FBQyx3R0FBd0c7UUFDNUgsbUJBQWMsR0FBRyxrQkFBa0IsQ0FBQyxlQUFlLENBQUM7UUFHcEQsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQzNCLG9CQUFlLEdBQUcsS0FBSyxDQUFDLENBQUMsNENBQTRDO1FBQ3JFLHdCQUFtQixHQUFHLEtBQUssQ0FBQyxDQUFDLCtGQUErRjtRQUM1SCxvQkFBZSxHQUFXLEVBQUUsQ0FBQyxDQUFDLG9EQUFvRDtRQUNsRixzQkFBaUIsR0FBVyxFQUFFLENBQUMsQ0FBQywwREFBMEQ7UUFDMUYsVUFBSyxHQUFZLENBQUMsQ0FBQztRQUNuQixVQUFLLEdBQVksQ0FBQyxDQUFDO1FBQ25CLFdBQU0sR0FBMEIsRUFBRSxDQUFDO1FBQ25DLGVBQVUsR0FBYSxFQUFFLENBQUM7UUFDMUIsa0JBQWEsR0FBYSxFQUFFLENBQUM7UUFNN0IsNERBQTREO1FBQzVELHlCQUFvQixHQUFHLEtBQUssQ0FBQztRQUM3Qiw0QkFBdUIsR0FBRyxNQUFNLENBQUMsQ0FBQyxjQUFjO1FBRWhELGtCQUFhLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7UUFLaEMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGtCQUFrQixDQUFDLGlCQUFpQixDQUFDO1FBQzdELElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM3RSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksa0JBQWtCLEVBQVMsQ0FBQztRQUNsRCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUMxQixDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUcsSUFBSSxDQUFDLEVBQUUsRUFBQyxDQUFDO1lBQ1YsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQzVCLENBQUM7YUFDRyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ25CLENBQUM7SUFDSCxDQUFDO0lBRUQsU0FBUztRQUVQLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDOUMsSUFBSSxFQUFFLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0JBQ25CLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNwQixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ2pELElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLElBQUksV0FBVyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDMUYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDeEUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDO29CQUNuRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUU7d0JBQ1osSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQzNDLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN6RSxDQUFDO2lCQUNGLENBQUMsQ0FBQTtZQUNKLENBQUM7WUFDRCxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztTQUNqQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLElBQUcsSUFBSSxDQUFDLFlBQVksRUFBQyxDQUFDO1lBQ3BCLElBQUcsSUFBSSxDQUFDLGNBQWMsS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUMsQ0FBQztnQkFDeEYsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNoRixDQUFDO2lCQUNJLElBQUcsSUFBSSxDQUFDLGNBQWMsS0FBSyxLQUFLLElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUMsQ0FBQztnQkFDakcsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMvRSxDQUFDO1FBQ0gsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUNwQixDQUFDO0lBRUQsV0FBVztRQUNULE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUNyRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLGtCQUFrQixDQUFDLFVBQVUsQ0FBQztRQUUvRCxLQUFLLE1BQU0sSUFBSSxJQUFJLFlBQVksRUFBRSxDQUFDO1lBQ2hDLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxXQUFXLEVBQUUsQ0FBQztnQkFDOUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUMsQ0FBQTtZQUN2RCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxjQUFjO1FBQ1osT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVELDJEQUEyRDtJQUMzRCw4R0FBOEc7SUFDOUcsYUFBYTtRQUNYLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFBO1FBQ3pCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxrQkFBa0IsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLFlBQVksR0FBQyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBQyxFQUFFLENBQUE7UUFDaEIsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELE9BQU87UUFDTCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakIsQ0FBQztJQUVELGNBQWMsQ0FBQyxLQUFVO1FBRXZCLE1BQU0sSUFBSSxHQUFTLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXpDLElBQUksSUFBSSxFQUFFLENBQUM7WUFDVCxJQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBQyxDQUFDO2dCQUMvQixPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFBO2dCQUM3QixJQUFJLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBSSxJQUFJLEdBQUcsNEJBQTRCLENBQUMsQ0FBQztZQUM3SCxDQUFDO2lCQUNJLENBQUM7Z0JBQ0osMENBQTBDO2dCQUMxQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssVUFBVSxFQUFFLENBQUM7b0JBQzdCLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO2dCQUM5QixDQUFDO3FCQUFNLElBQUksa0JBQWtCLEVBQUUsQ0FBQztvQkFDOUIsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUM7Z0JBQy9CLENBQUM7Z0JBRUQsNkJBQTZCO2dCQUM3QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBRTFCLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQ2hDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUNqQyxNQUFNLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtvQkFDbkIsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsTUFBZ0IsQ0FBQztvQkFDNUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7b0JBQ3RELElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2dCQUM1QixDQUFDLENBQUE7Z0JBQ0QsTUFBTSxDQUFDLE9BQU8sR0FBRyxHQUFHLEVBQUU7b0JBQ3BCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO2dCQUN6RSxDQUFDLENBQUE7WUFDSCxDQUFDO1FBRUgsQ0FBQzthQUNJLENBQUM7WUFDSixJQUFJLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUN6RSxDQUFDO0lBQ0gsQ0FBQztJQUVELG9CQUFvQixDQUFDLFlBQWlCLEVBQUUsY0FBc0I7UUFDNUQsdUVBQXVFO1FBQ3ZFLElBQUcsQ0FBQyxZQUFZLEVBQUMsQ0FBQztZQUNoQixZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQTtRQUNsQyxDQUFDO1FBQ0QsSUFBRyxDQUFDLGNBQWMsRUFBQyxDQUFDO1lBQ2xCLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFBO1FBQ3RDLENBQUM7UUFFRCxJQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO1lBQ25ELElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDOUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQ3ZFLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2xJLENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDNUIsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7UUFDN0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDbEMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFL0QsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLEVBQUUsY0FBYyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUzSCxJQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBQyxDQUFDO1lBQzFCLDhEQUE4RDtZQUM5RCxJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztZQUM3QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO1lBQy9CLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUMsY0FBYyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUMsQ0FBQyxDQUFDO1FBRXpGLENBQUM7YUFDSSxDQUFDO1lBQ0osZ0ZBQWdGO1lBQ2hGLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLEVBQUUsY0FBYyxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDekYsQ0FBQztJQUNILENBQUM7SUFFRCxtQkFBbUIsQ0FBQyxLQUFxQjtRQUN2QyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQixDQUFDO1FBQ0QsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3RELElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQzNDLElBQUksQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDO1FBQy9CLENBQUM7YUFBTSxJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN2RCxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztRQUM5QixDQUFDO0lBQ0gsQ0FBQztJQUVELHdCQUF3QixDQUFDLFdBQStCLEVBQUUsUUFBZ0I7UUFDeEUsSUFBRyxDQUFDLFdBQVcsSUFBSSxXQUFXLENBQUMsS0FBSyxFQUFFLE1BQU0sS0FBSyxDQUFDLEVBQUMsQ0FBQztZQUNsRCxPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUM7UUFDRCxPQUFPLFdBQVcsQ0FBQyxLQUFLO2FBQ3JCLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDO2FBQy9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7YUFDbkMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBQUEsQ0FBQztJQUVGLGVBQWUsQ0FBQyxRQUFnQjtRQUM5QixNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pELElBQUksT0FBTztZQUFFLE9BQU8sQ0FBQyxjQUFjLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFBO0lBQzdFLENBQUM7SUFFRCx5QkFBeUIsQ0FBQyxXQUFtQjtRQUMzQyxpQ0FBaUM7UUFDakMsT0FBTyxDQUFDLFdBQVcsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBRSxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBRSxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7SUFFRCxxSEFBcUg7SUFDckgsa0JBQWtCLENBQUMsUUFBYTtRQUM5QixJQUFJLFVBQVUsR0FBRyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDaEcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsd0RBQXdEO0lBRWhELG9CQUFvQixDQUFDLFlBQWlCLEVBQUUsY0FBc0IsRUFBRSxFQUFVO1FBQ2hGLHFEQUFxRDtRQUNyRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUM7UUFDaEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFFeEIsSUFBRyxJQUFJLENBQUMsY0FBYyxLQUFLLE1BQU0sRUFBQyxDQUFDO1lBQ2pDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFDLENBQUM7YUFDSSxJQUFHLElBQUksQ0FBQyxjQUFjLEtBQUssS0FBSyxFQUFDLENBQUM7WUFDckMsSUFBSSxlQUFlLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ2hGLFlBQVksR0FBRyxlQUFlLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQztRQUMzRCxDQUFDO1FBRUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLG9CQUFvQixDQUFDLFlBQVksRUFBRSxjQUFjLEVBQUUsRUFBRSxDQUFDO2FBQzdFLFNBQVMsQ0FBQztZQUNULElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUNqQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO2dCQUMvQixJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO2dCQUMzQixJQUFHLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssYUFBYSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLEtBQUssUUFBUSxDQUFDLFdBQVcsRUFBRSxFQUFDLENBQUM7b0JBQzFILElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO29CQUM1QixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBQyxDQUFDLENBQUM7Z0JBQ2xFLENBQUM7cUJBQ0ksQ0FBQztvQkFDSixJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztvQkFDN0IsSUFBSSxDQUFDLGtCQUFrQixHQUFHLHlDQUF5QyxDQUFDO29CQUNwRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUNwRCxDQUFDO2dCQUVELDhHQUE4RztnQkFDOUcsc0ZBQXNGO2dCQUN0RixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBWSxFQUFFLEVBQUU7b0JBQzdCLE9BQU8sQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFBO2dCQUN4RSxDQUFDLENBQUMsQ0FBQTtnQkFHRix1QkFBdUI7Z0JBQ3ZCLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBTSxFQUFFLENBQU0sRUFBRSxFQUFFO29CQUNwQyxPQUFPLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNHLENBQUMsQ0FBQyxDQUFDO2dCQUVILHlHQUF5RztnQkFDekcsd0JBQXdCO2dCQUN4QixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBWSxFQUFFLEVBQUU7b0JBQ2hELElBQUksTUFBTSxHQUFpQixNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztvQkFDdEQsTUFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7b0JBQ3ZCLE9BQU8sTUFBTSxDQUFBO2dCQUNmLENBQUMsQ0FBQyxDQUFDO2dCQUVILElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2dCQUM1RCxJQUFJLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLFdBQVksQ0FBQyxpQkFBaUIsR0FBRyxRQUFRLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDO1lBQzlFLENBQUM7WUFDRCxLQUFLLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDYixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFDdkIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztnQkFDaEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7Z0JBQ3BDLElBQUcsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUMsQ0FBQztvQkFDcEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDekMsQ0FBQztnQkFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDMUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixDQUFDO1lBQ0QsUUFBUSxFQUFFLEdBQUcsRUFBRTtnQkFDYixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztZQUN6QixDQUFDO1NBQ0YsQ0FBQyxDQUFDO1FBRUwscUZBQXFGO1FBQ3JGLFVBQVUsQ0FDUixHQUFHLEVBQUU7WUFDSCxJQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDbEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7WUFDbkMsQ0FBQztRQUNILENBQUMsRUFBRSxJQUFJLENBQUMsdUJBQXVCLENBQ2hDLENBQUM7SUFFSixDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLE9BQU8sVUFBVSxHQUFRLEVBQUUsT0FBZTtZQUN4QyxJQUFJLFdBQVcsR0FBWSxLQUFLLENBQUM7WUFDakMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBYyxFQUFFLEVBQUU7Z0JBQ25DLElBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQztvQkFDaEUsV0FBVyxHQUFHLElBQUksQ0FBQztnQkFDckIsQ0FBQztZQUNILENBQUMsQ0FDRixDQUFBO1lBQ0QsT0FBTyxXQUFXLENBQUM7UUFDckIsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztJQUN6QixDQUFDO0lBRUQsNEJBQTRCO1FBQzFCOzs7O1VBSUU7UUFDRixNQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNqRyxJQUFHLHFCQUFxQixLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQzFCLENBQUM7YUFDSSxJQUFHLHFCQUFxQixLQUFLLENBQUMsRUFBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBQzNCLENBQUM7SUFDSCxDQUFDO0lBRUQsZUFBZSxDQUFDLFFBQWdCO1FBQzlCLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsS0FBSyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUNsSCxDQUFDO0lBRUQsUUFBUSxDQUFDLEtBQVU7UUFDakIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUk7YUFDeEIsTUFBTSxDQUFDLENBQUMsT0FBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxLQUFLLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQzthQUNoRixNQUFNLENBQUM7SUFDWixDQUFDO0lBRUQseUJBQXlCO1FBQ3ZCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7UUFDakMsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztJQUM5QixDQUFDO0lBRU8sb0JBQW9CLENBQUMsV0FBZ0IsRUFBRSxRQUFnQjtRQUM3RCxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsRUFBRSxNQUFNLElBQUksQ0FBQyxDQUFDO1FBQ3pHLE1BQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLFNBQVMsQ0FBQyxFQUFFLE1BQU0sSUFBSSxDQUFDLENBQUM7UUFDN0csTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFZLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxRQUFRLElBQUksYUFBYSxDQUFDLEVBQUUsTUFBTSxJQUFJLENBQUMsQ0FBQztRQUM3RyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQVksRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsRUFBRSxNQUFNLElBQUksQ0FBQyxDQUFDO1FBRXZHLElBQUksZ0JBQWdCLEdBQXNCLEVBQUUsQ0FBQztRQUM3QyxnQkFBZ0IsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQzNDLGdCQUFnQixDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDL0MsZ0JBQWdCLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUN6QyxnQkFBZ0IsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBRXZDLGdCQUFnQixDQUFDLE9BQU8sR0FBRyxXQUFXLElBQUksQ0FBQyxDQUFDO1FBQzVDLGdCQUFnQixDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDckMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQscUJBQXFCO1FBQ25CLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7UUFDN0IsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztRQUM3QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUM7UUFDakMsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsb0JBQW9CLEdBQUcsS0FBSyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQzFCLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxJQUFZLEVBQUUsQ0FBUztRQUV0QyxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQzVFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBQzVCLE9BQU8sWUFBWSxDQUFDO1FBQ3RCLENBQUM7YUFDSSxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQ25GLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBQzVCLE9BQU8sY0FBYyxDQUFDO1FBQ3hCLENBQUM7YUFDSSxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQ3ZGLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBQzVCLE9BQU8sV0FBVyxDQUFDO1FBQ3JCLENBQUM7YUFDSSxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQ2hGLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO1lBQzVCLE9BQU8sV0FBVyxDQUFDO1FBQ3JCLENBQUM7O1lBRUksT0FBTSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUdELHVCQUF1QjtRQUNyQix3RUFBd0U7UUFDeEUsdUZBQXVGO1FBQ3ZGLE1BQU0sWUFBWSxHQUFHLElBQUksRUFBRSxXQUFXLEVBQUUsaUJBQWlCLElBQUksRUFBRSxDQUFDO1FBQ2hFLHNCQUFzQjtRQUN0QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUk7YUFDckMsR0FBRyxDQUFDLE9BQU8sQ0FBQSxFQUFFLEdBQUcsT0FBTyxFQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQSxDQUFBLENBQUMsQ0FBQzthQUN2SixNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRixJQUFJLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLEVBQUMsWUFBWSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQztJQUM5RixDQUFDO0lBR0QsaUJBQWlCLENBQUMsY0FBc0IsRUFBRSxNQUE2QjtRQUNyRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUcsY0FBYyxDQUFDLENBQUMsR0FBRyxDQUFFLEVBQUUsQ0FBQSxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2hHLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsRUFBRSxDQUFDLEVBQUUsSUFBSSxTQUFTLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxjQUFjLElBQUksRUFBRSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM1RyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBRUQsYUFBYSxDQUFDLGNBQXNCLEVBQUUsaUJBQXlCO1FBQzdELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLGNBQWMsSUFBSSxFQUFFLENBQUMsT0FBTyxJQUFJLGlCQUFpQixDQUFDLENBQUM7SUFDekcsQ0FBQzs4R0FoZVUseUJBQXlCO2tHQUF6Qix5QkFBeUIsa2hDQXdCYSxVQUFVLDZCQzFEN0QsdW1nQkEyWUEsaTRTRG5YYztZQUNWLE9BQU8sQ0FBQyxjQUFjLEVBQUU7Z0JBQ3RCLEtBQUssQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztnQkFDMUQsS0FBSyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsRUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztnQkFDdkMsVUFBVSxDQUFDLHdCQUF3QixFQUFFLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO2FBQ3RGLENBQUM7U0FDSDs7MkZBSVUseUJBQXlCO2tCQWRyQyxTQUFTOytCQUNFLHdCQUF3QixjQUd0Qjt3QkFDVixPQUFPLENBQUMsY0FBYyxFQUFFOzRCQUN0QixLQUFLLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7NEJBQzFELEtBQUssQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7NEJBQ3ZDLFVBQVUsQ0FBQyx3QkFBd0IsRUFBRSxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQzt5QkFDdEYsQ0FBQztxQkFDSDt5RkFLUSxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLHlCQUF5QjtzQkFBakMsS0FBSztnQkFDRywyQkFBMkI7c0JBQW5DLEtBQUs7Z0JBQ0csc0JBQXNCO3NCQUE5QixLQUFLO2dCQUNHLHNCQUFzQjtzQkFBOUIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLHdCQUF3QjtzQkFBaEMsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLHFCQUFxQjtzQkFBN0IsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUNHLGtCQUFrQjtzQkFBMUIsS0FBSztnQkFDRyx3QkFBd0I7c0JBQWhDLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFDRyxxQkFBcUI7c0JBQTdCLEtBQUs7Z0JBQ0csOEJBQThCO3NCQUF0QyxLQUFLO2dCQUVJLFlBQVk7c0JBQXJCLE1BQU07Z0JBQ0csVUFBVTtzQkFBbkIsTUFBTTtnQkFDRyx3QkFBd0I7c0JBQWpDLE1BQU07Z0JBQ0cseUJBQXlCO3NCQUFsQyxNQUFNO2dCQUNFLEVBQUU7c0JBQVYsS0FBSztnQkFHd0QsUUFBUTtzQkFBckUsU0FBUzt1QkFBQyxnQkFBZ0IsRUFBQyxFQUFDLE1BQU0sRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCwgT25Jbml0LFxuICBPdXRwdXQsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7VmFsaWRhdG9yQ29uc3RhbnRzfSBmcm9tIFwiLi4vcHJvdmlkZXJzL3ZhbGlkYXRvci1jb25zdGFudHNcIjtcbmltcG9ydCB7Rm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVW50eXBlZEZvcm1Db250cm9sLCBWYWxpZGF0b3JzfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7TWF0VGFibGVEYXRhU291cmNlfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWwvdGFibGVcIjtcbmltcG9ydCB7RmhpclZhbGlkYXRvclNlcnZpY2V9IGZyb20gXCIuLi9zZXJ2aWNlcy9maGlyLXZhbGlkYXRvci5zZXJ2aWNlXCI7XG5pbXBvcnQge1Jlc3BvbnNlSXRlbX0gZnJvbSBcIi4uL21vZGFsL3Jlc3BvbnNlLWl0ZW1cIjtcbmltcG9ydCB7VmFsaWRhdGlvblJlc3VsdHN9IGZyb20gXCIuLi9tb2RhbC92YWxpZGF0aW9uLXJlc3VsdHNcIjtcbmltcG9ydCB7YW5pbWF0ZSwgc3RhdGUsIHN0eWxlLCB0cmFuc2l0aW9uLCB0cmlnZ2VyfSBmcm9tIFwiQGFuZ3VsYXIvYW5pbWF0aW9uc1wiO1xuaW1wb3J0IHtBcGlSZXNwb25zZX0gZnJvbSBcIi4uL21vZGFsL2FwaS1yZXNwb25zZVwiO1xuaW1wb3J0IHtWYWxpZGF0b3JJbnB1dH0gZnJvbSBcIi4uL21vZGFsL3ZhbGlkYXRvci1pbnB1dC1mb3JtYXRcIjtcbmltcG9ydCB7SW1wbGVtZW50YXRpb25HdWlkZX0gZnJvbSBcIi4uL21vZGFsL2ltcGxlbWVudGF0aW9uLWd1aWRlXCI7XG5cbmV4cG9ydCB0eXBlIFN1Ym1pdEJ1dHRvbkFsaWdubWVudCA9ICdsZWZ0JyB8ICdyaWdodCc7XG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItbmd4LWZoaXItdmFsaWRhdG9yJyxcbiAgdGVtcGxhdGVVcmw6ICduZ3gtZmhpci12YWxpZGF0b3IuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnbmd4LWZoaXItdmFsaWRhdG9yLmNvbXBvbmVudC5zY3NzJ10sXG4gIGFuaW1hdGlvbnM6IFtcbiAgICB0cmlnZ2VyKCdkZXRhaWxFeHBhbmQnLCBbXG4gICAgICBzdGF0ZSgnY29sbGFwc2VkJywgc3R5bGUoe2hlaWdodDogJzBweCcsIG1pbkhlaWdodDogJzAnfSkpLFxuICAgICAgc3RhdGUoJ2V4cGFuZGVkJywgc3R5bGUoe2hlaWdodDogJyonfSkpLFxuICAgICAgdHJhbnNpdGlvbignZXhwYW5kZWQgPD0+IGNvbGxhcHNlZCcsIGFuaW1hdGUoJzIyNW1zIGN1YmljLWJlemllcigwLjQsIDAuMCwgMC4yLCAxKScpKSxcbiAgICBdKSxcbiAgXSxcbn0pXG5cblxuZXhwb3J0IGNsYXNzIE5neEZoaXJWYWxpZGF0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXR7XG4gIEBJbnB1dCgpIHZhbGlkYXRvclRpdGxlOiBzdHJpbmcgPSAnJztcbiAgQElucHV0KCkgdmFsaWRhdGlvblJlc3VsdHNFeHBhbmRlZDogYm9vbGVhbiA9IGZhbHNlOyAvLyBWYWxpZGF0aW9uIHJlc3VsdHMgZGV0YWlscyBpbml0aWFsIHN0YXRlXG4gIEBJbnB1dCgpIHJlc3VsdERldGFpbHNFeHBhbmRCdG5TaG93bjogYm9vbGVhbiA9IHRydWU7IC8vIFNob3cvaGlkZSBFeHBhbmQgVmFsaWRhdGlvbiBSZXN1bHRzIGJ0blxuICBASW5wdXQoKSBmb3JtYXRSZXNvdXJjZUJ0blNob3duOiBib29sZWFuID0gZmFsc2U7IC8vIFNob3cvaGlkZSBGb3JtYXQgUmVzb3VyY2UgYnRuXG4gIEBJbnB1dCgpIGNsZWFyVmFsaWRhdG9yQnRuU2hvd246IGJvb2xlYW4gPSB0cnVlOyAvLyBTaG93L2hpZGUgQ2xlYXIgVmFsaWRhdG9yIGJ0blxuICBASW5wdXQoKSBzdWJtaXRCdG5TaG93bjogYm9vbGVhbiA9IHRydWU7IC8vIFNob3cvaGlkZSBTdWJtaXQgYnRuXG4gIEBJbnB1dCgpIGV4cG9ydFJlc3VsdHNCdXR0b25TaG93biA9IHRydWU7XG4gIEBJbnB1dCgpIHN1Ym1pdEJ0blRpdGxlOiBzdHJpbmcgPSAnU3VibWl0JzsgLy9UaGUgc3VibWl0IGJ1dHRvbiB0aXRsZS4gXCJTdWJtaXRcIiBpcyBnZW5lcmljIG5hbWUgYW5kIG90aGVyIGFwcHMgbWF5IHdhbnQgdG8gY2hhbmdlIGl0XG4gIEBJbnB1dCgpIHZhbGlkYXRpb25JbnB1dEZvcm1hdDogVmFsaWRhdG9ySW5wdXQgPSB7Zm9ybWF0OiAnanNvbicsIGFjY2VwdHM6ICcuanNvbid9O1xuICBASW5wdXQoKSBtYXhGaWxlU2l6ZSA9IDI1MDAwMCAvLyBNYXggYWxsb3dlZCBmaWxlIHNpemUgaXMgMjUwS0JcbiAgQElucHV0KCkgc3VibWl0QnRuQWxpZ25tZW50OiBTdWJtaXRCdXR0b25BbGlnbm1lbnQgPSAncmlnaHQnOyAvLyBUaGUgZGVmYXVsdCBsb2NhdGlvbiBmb3IgdGhlIFN1Ym1pdCBidG5cbiAgQElucHV0KCkgY2FuY2VsVmFsaWRhdGlvbkJ0blNob3duOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCkgYnV0dG9uVHh0Q29sb3I6IHN0cmluZyAgPSAnd2hpdGUnO1xuICBASW5wdXQoKSBidXR0b25CYWNrZ3JvdW5kQ29sb3I9JyM0ODU4QjgnO1xuICBASW5wdXQoKSBleHBvcnRWYWxpZGF0aW9uUmVzdWx0c0J0bk5hbWU6IHN0cmluZyA9ICdFeHBvcnQgUmVzdWx0cyAoLnppcCknO1xuXG4gIEBPdXRwdXQoKSBvblZhbGlkYXRpb24gPSBuZXcgRXZlbnRFbWl0dGVyPFZhbGlkYXRpb25SZXN1bHRzPigpO1xuICBAT3V0cHV0KCkgb25BcGlFcnJvciA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb25SZXNvdXJjZUNvbnRlbnRDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBvbkV4cG9ydFZhbGlkYXRpb25SZXN1bHRzID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBJbnB1dCgpIGlnOiBJbXBsZW1lbnRhdGlvbkd1aWRlO1xuXG5cbiAgQFZpZXdDaGlsZCgndmFsaWRhdG9ySW5wdXQnLHtzdGF0aWM6ZmFsc2UsIHJlYWQ6IEVsZW1lbnRSZWZ9KSBpbnB1dFJlZjogYW55O1xuXG4gIGFwaVJlc3BvbnNlOiBBcGlSZXNwb25zZSB8IG51bGw7XG4gIGZoaXJSZXNvdXJjZTogc3RyaW5nID0gJycvLyBUaGUgUmVzb3VyY2UuXG4gIHJlc291cmNlRm9ybWF0ID0gJ2pzb24nOyAvLyBUaGUgcmVzb3VyY2UgZm9ybWF0IGNvdWxkIGJlIEpTT04gb3IgWE1MLCB3aXRoIEpTT04gYmVpbmcgdGhlIGRlZmF1bHQgZm9ybWF0LlxuICBmaWxlTmFtZTogc3RyaW5nID0gJyc7IC8vIE5hbWUgb2YgdGhlIGZpbGUgdXBsb2FkZWQgYnkgdGhlIHVzZXIuIFdlIG5lZWQgdGhpcyB0byByZW5kZXIgdGhlIGZpbGVuYW1lIGluIHRoZSBVSS5cbiAgdmFsaWRhdGlvbkVycm9yU3RyOiBzdHJpbmcgPSAnJzsgLy8gV2UgdXNlIHRoaXMgdmFsdWUgdG8gc3RvcmUgcHJlbGltaW5hcnkgZXJyb3IgbWVzc2FnZXMgb3IgYSBnZW5lcmljIGVycm9yIG1lc3NhZ2UuXG4gIGhhc1Jlc3BvbnNlRGF0YSA9IGZhbHNlOyAgLy8gSW5kaWNhdGVzIGlmIHRoZSByZXNwb25zZSBnZW5lcmF0ZWQgYW55IG1lc3NhZ2VzLiBJZiB0cnVlLCB3ZSByZW5kZXIgdGhlIHJlcG9ydFxuICBwYXJzZWRGaGlyUmVzb3VyY2U6IHN0cmluZyA9ICcnOyAvLyBXZSBzdG9yZSB2YWx1ZSBvZiB0aGUgdmFsaWRhdG9yIHJlc3VsdCBpbiBvcmRlciB0byBwcmVzZW50IGl0IHRvIHRoZSB1c2VyLlxuICBkaXNwbGF5ZWRDb2x1bW5zOiBzdHJpbmdbXTtcbiAgaXNMb2FkaW5nID0gZmFsc2U7XG4gIGFsbEV4cGFuZGVkID0gdHJ1ZTsgLy8gVXNlZCB0byByZW5kZXIgY29sbGFwc2VkL2V4cGFuZGVkIGFsbCBpY29uIGFzIHdlbGwgYXMgY2FsY3VsYXRlIGlmIGFsbCByZXN1bHRzIGFyZSBleHBhbmRlZC9jb2xsYXBzZWRcbiAgc2V2ZXJpdHlMZXZlbHMgPSBWYWxpZGF0b3JDb25zdGFudHMuU0VWRVJJVFlfTEVWRUxTO1xuICBzZXZlcml0eUxldmVsc0Zvcm1Db250cm9sOiBVbnR5cGVkRm9ybUNvbnRyb2w7IC8vIEEgc2ltcGxlIGZvcm0gY29udHJvbCB1c2VkIGZvciBmaWx0ZXJpbmcgdGhlIHJlc3VsdHMuXG4gIGRhdGFTb3VyY2U6IE1hdFRhYmxlRGF0YVNvdXJjZTxhbnk+Oy8vIERhdGEgc291cmNlIGZvciB0aGUgcmVwb3J0IHRhYmxlLlxuICB2YWxpZGF0aW9uRmluaXNoZWQgPSBmYWxzZTtcbiAgaXNWYWxpZFJlc291cmNlID0gZmFsc2U7IC8vIFdlIHVzZSB0aGlzIHRvIHJlbmRlciB0aGUgc3VjY2VzcyBtZXNzYWdlXG4gIHNlcnZlckVycm9yRGV0ZWN0ZWQgPSBmYWxzZTsgLy8gVHJhY2tzIGlmIHRoZSBzZXJ2ZXIgaGFzIHJlc3BvbmRlZCB3aXRoIGFuIGVycm9yICg0MDQsIDUwMCkuIFVzZWQgdG8gcmVuZGVyIHRoZSBlcnJvciBpbiBVSS5cbiAgc2VydmVyRXJyb3JMaXN0OiBhbnkgW10gPSBbXTsgLy8gU3RvcmUgdGhlIGRhdGEgZnJvbSB0aGUgT3BlcmF0aW9uT3V0Y29tZSByZXNvdXJjZVxuICBzZXJ2ZXJFcnJvclN0YXR1czogc3RyaW5nID0gJyc7IC8vIFdlIHN0b3JlIHRoZSBlcnJvciByZXNwb25zZSBzdGF0dXMgaGVyZSAoaS5lLiA0MDQsIDUwMClcbiAgbGluZXMgOiBudW1iZXIgPSAxO1xuICB3aWR0aCA6IG51bWJlciA9IDA7XG4gIGlnTGlzdDogSW1wbGVtZW50YXRpb25HdWlkZVtdID0gW107XG4gIGlnTmFtZUxpc3Q6IHN0cmluZ1tdID0gW107XG4gIGlnVmVyc2lvbkxpc3Q6IHN0cmluZ1tdID0gW107XG4gIHNlbGVjdGVkSWdOYW1lOiBzdHJpbmc7XG4gIHNlbGVjdGVkSWdWZXJzaW9uOiBzdHJpbmc7XG4gIGlnVmVyc2lvbkRyb3Bkb3duTGlzdDogc3RyaW5nW107XG4gIHNlbGVjdGVkSUc6IEltcGxlbWVudGF0aW9uR3VpZGU7XG5cbiAgLy9UT0RPIHJlbW92ZSB0aGlzIGNvZGUgd2hlbiB0aGUgQVBJIHJldHVybnMgYSB0aW1lb3V0IGVycm9yXG4gIHNlcnZlclRpbW91dERldGVjdGVkID0gZmFsc2U7XG4gIFNFUlZFUl9USU1FT1VUX0lOVEVSVkFMID0gMjQwMDAwOyAvL2ZvdXIgbWludXRlc1xuXG4gIGlnU2VsZWN0aW9uRmcgPSBuZXcgRm9ybUdyb3VwKHt9KTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGZoaXJWYWxpZGF0b3JTZXJ2aWNlOiBGaGlyVmFsaWRhdG9yU2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5kaXNwbGF5ZWRDb2x1bW5zID0gVmFsaWRhdG9yQ29uc3RhbnRzLkRJU1BMQVlFRF9DT0xVTU5TO1xuICAgIHRoaXMuc2V2ZXJpdHlMZXZlbHNGb3JtQ29udHJvbCA9IG5ldyBVbnR5cGVkRm9ybUNvbnRyb2wodGhpcy5zZXZlcml0eUxldmVscyk7XG4gICAgdGhpcy5kYXRhU291cmNlID0gbmV3IE1hdFRhYmxlRGF0YVNvdXJjZTxhbnlbXT4oKTtcbiAgICB0aGlzLmFwaVJlc3BvbnNlID0gbnVsbDtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmKHRoaXMuaWcpe1xuICAgICAgdGhpcy5zZWxlY3RlZElHID0gdGhpcy5pZztcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgIHRoaXMuZ2V0SWdMaXN0KCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0SWdMaXN0KCkge1xuXG4gICAgdGhpcy5maGlyVmFsaWRhdG9yU2VydmljZS5nZXRJZ0xpc3QoKS5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5pZ0xpc3QgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5pZ05hbWVMaXN0ID0gdmFsdWUubWFwKGVsID0+IGVsLm5hbWUpO1xuICAgICAgICB0aGlzLmlnTmFtZUxpc3QgPSBbLi4ubmV3IFNldCh0aGlzLmlnTmFtZUxpc3QpXTtcbiAgICAgICAgdGhpcy5pZ1ZlcnNpb25MaXN0ID0gdmFsdWUubWFwKGVsID0+IGVsLnZlcnNpb24pO1xuICAgICAgICB0aGlzLmlnU2VsZWN0aW9uRmcuYWRkQ29udHJvbCgnc2VsZWN0ZWRJZ05hbWUnLCBuZXcgRm9ybUNvbnRyb2woJycsIFZhbGlkYXRvcnMucmVxdWlyZWQpKTtcbiAgICAgICAgdGhpcy5pZ1NlbGVjdGlvbkZnLmFkZENvbnRyb2woJ3NlbGVjdGVkSWdWZXJzaW9uJywgbmV3IEZvcm1Db250cm9sKCcnKSk7XG4gICAgICAgIHRoaXMuaWdTZWxlY3Rpb25GZy5jb250cm9sc1snc2VsZWN0ZWRJZ05hbWUnXS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiB2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdldElnVmVyc2lvbnNMaXN0KHZhbHVlLCB0aGlzLmlnTGlzdCk7XG4gICAgICAgICAgICB0aGlzLmlnU2VsZWN0aW9uRmcuY29udHJvbHNbJ3NlbGVjdGVkSWdWZXJzaW9uJ10ucGF0Y2hWYWx1ZSgnY3VycmVudCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgIH0pO1xuXG4gIH1cblxuICBmb3JtYXRGaGlyUmVzb3VyY2UoKXtcbiAgICBpZih0aGlzLmZoaXJSZXNvdXJjZSl7XG4gICAgICBpZih0aGlzLnJlc291cmNlRm9ybWF0ID09PSAnanNvbicgJiYgdGhpcy5maGlyVmFsaWRhdG9yU2VydmljZS5pc0pzb24odGhpcy5maGlyUmVzb3VyY2UpKXtcbiAgICAgICAgdGhpcy5maGlyUmVzb3VyY2UgPSB0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLmJlYXV0aWZ5SlNPTih0aGlzLmZoaXJSZXNvdXJjZSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKHRoaXMucmVzb3VyY2VGb3JtYXQgPT09ICd4bWwnICYmIHRoaXMuZmhpclZhbGlkYXRvclNlcnZpY2UuaXNYbWxTdHJpbmcodGhpcy5maGlyUmVzb3VyY2UpKXtcbiAgICAgICAgdGhpcy5maGlyUmVzb3VyY2UgPSB0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLmJlYXV0aWZ5WE1MKHRoaXMuZmhpclJlc291cmNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5saW5lTnVtYmVycygpXG4gIH1cblxuICBsaW5lTnVtYmVycygpIHtcbiAgICBjb25zdCBsaW5lZFN0cmluZ3MgPSB0aGlzLmZoaXJSZXNvdXJjZS5zcGxpdCgvW1xcblxccl0vZyk7XG4gICAgdGhpcy5saW5lcyA9IGxpbmVkU3RyaW5ncy5sZW5ndGg7XG4gICAgdGhpcy53aWR0aCA9IHRoaXMuaW5wdXRSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICBjb25zdCBjaGFySW5MaW5lcyA9IHRoaXMud2lkdGggLyBWYWxpZGF0b3JDb25zdGFudHMuRk9OVF9XSURUSDtcblxuICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lZFN0cmluZ3MpIHtcbiAgICAgIGlmIChsaW5lLmxlbmd0aCA+IGNoYXJJbkxpbmVzKSB7XG4gICAgICAgIHRoaXMubGluZXMgPSB0aGlzLmxpbmVzICsgKGxpbmUubGVuZ3RoIC8gY2hhckluTGluZXMpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0TGluZU51bWJlcnMoKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oe2xlbmd0aDogdGhpcy5saW5lc30sIChfLCBpKSA9PiAoaSArIDEpLnRvU3RyaW5nKCkpO1xuICB9XG5cbiAgLy8gSXQgaXMgaW1wb3J0YW50IHRoZSBmb3JtYXQgaXMgd29ya2luZyB3aXRoIFwiYmVzdCBlZmZvcnRcIlxuICAvLyBUaGF0IGlzIGl0IG1heSBvciBtYXkgbm90IGZvcm1hdCB0aGUgdGV4dCBwcm9wZXJseSBhbmQgcmVxdWlyZSBleHRlbnNpdmUgdGVzdGluZyB0byB2YWxpZGF0ZSBpdHMgb3BlcmF0aW9uLlxuICBvbkZvcm1hdElucHV0KCkge1xuICAgIHRoaXMuZm9ybWF0RmhpclJlc291cmNlKClcbiAgICB0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLnNob3dTdWNjZXNzTWVzc2FnZShcIkZvcm1hdHRpbmcgQXR0ZW1wdGVkLlwiKTtcbiAgfVxuXG4gIGNsZWFyVUkoKXtcbiAgICB0aGlzLmZoaXJSZXNvdXJjZT0nJztcbiAgICB0aGlzLmZpbGVOYW1lPScnXG4gICAgdGhpcy5jbGVhclZhbGlkYXRpb25FcnJvcnMoKTtcbiAgICB0aGlzLm9uUmVzb3VyY2VDb250ZW50Q2hhbmdlZC5lbWl0KHRoaXMuZmhpclJlc291cmNlKTtcbiAgfVxuXG4gIG9uQ2xlYXIoKXtcbiAgICB0aGlzLmNsZWFyVUkoKTtcbiAgfVxuXG4gIG9uRmlsZVNlbGVjdGVkKGV2ZW50OiBhbnkpIHtcblxuICAgIGNvbnN0IGZpbGU6IEZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07XG5cbiAgICBpZiAoZmlsZSkge1xuICAgICAgaWYoZmlsZS5zaXplID4gdGhpcy5tYXhGaWxlU2l6ZSl7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGaWxlIHRvbyBiaWdcIilcbiAgICAgICAgdGhpcy5maGlyVmFsaWRhdG9yU2VydmljZS5zaG93RXJyb3JNZXNzYWdlKFwiVGhpcyBmaWxlIGV4Y2VlZHMgXCIgKyB0aGlzLm1heEZpbGVTaXplIC8gIDEwMDAgKyBcImtiIGFuZCBjYW5ub3QgYmUgcHJvY2Vzc2VkXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIGF1dG8gdG9nZ2xlIHRoZSBmaWxlIHR5cGUgcmFkaW8gYnV0dG9uc1xuICAgICAgICBpZiAoZmlsZS50eXBlID09PSBcInRleHQveG1sXCIpIHtcbiAgICAgICAgICB0aGlzLnJlc291cmNlRm9ybWF0ID0gJ3htbCc7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJhcHBsaWNhdGlvbi9qc29uXCIpIHtcbiAgICAgICAgICB0aGlzLnJlc291cmNlRm9ybWF0ID0gJ2pzb24nO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2V0IHRoZSBmaWxlbmFtZSBpbiB0aGUgVUlcbiAgICAgICAgdGhpcy5maWxlTmFtZSA9IGZpbGUubmFtZTtcblxuICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlLCBcIlVURi04XCIpO1xuICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZmhpclJlc291cmNlID0gcmVhZGVyLnJlc3VsdCBhcyBzdHJpbmc7XG4gICAgICAgICAgdGhpcy5vblJlc291cmNlQ29udGVudENoYW5nZWQuZW1pdCh0aGlzLmZoaXJSZXNvdXJjZSk7XG4gICAgICAgICAgdGhpcy5mb3JtYXRGaGlyUmVzb3VyY2UoKTtcbiAgICAgICAgfVxuICAgICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICB0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLnNob3dFcnJvck1lc3NhZ2UoXCJVbmFibGUgdG8gb3BlbiB0aGUgZmlsZS5cIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZmhpclZhbGlkYXRvclNlcnZpY2Uuc2hvd0Vycm9yTWVzc2FnZShcIlVuYWJsZSB0byBvcGVuIHRoZSBmaWxlLlwiKTtcbiAgICB9XG4gIH1cblxuICB2YWxpZGF0ZUZoaXJSZXNvdXJjZShmaGlyUmVzb3VyY2U6IGFueSwgcmVzb3VyY2VGb3JtYXQ6IHN0cmluZykge1xuICAgIC8vIFNldCB0aGUgc3RhZ2UgZm9yIHRoZSB2YWxpZGF0aW9uLiBSZXNldCB2YXJpYWJsZXMgdG8gZGVmYXVsdCB2YWx1ZXMuXG4gICAgaWYoIWZoaXJSZXNvdXJjZSl7XG4gICAgICBmaGlyUmVzb3VyY2UgPSB0aGlzLmZoaXJSZXNvdXJjZVxuICAgIH1cbiAgICBpZighcmVzb3VyY2VGb3JtYXQpe1xuICAgICAgcmVzb3VyY2VGb3JtYXQgPSB0aGlzLnJlc291cmNlRm9ybWF0XG4gICAgfVxuXG4gICAgaWYodGhpcy5pZ1NlbGVjdGlvbkZnLmNvbnRyb2xzPy5bJ3NlbGVjdGVkSWdOYW1lJ10pIHtcbiAgICAgIHRoaXMuaWdTZWxlY3Rpb25GZy5jb250cm9sc1snc2VsZWN0ZWRJZ05hbWUnXS5tYXJrQXNUb3VjaGVkKCk7XG4gICAgICB0aGlzLmlnU2VsZWN0aW9uRmcuY29udHJvbHNbJ3NlbGVjdGVkSWdOYW1lJ10udXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICAgICAgaWYgKHRoaXMuaWdTZWxlY3Rpb25GZy52YWxpZCkge1xuICAgICAgICB0aGlzLnNldFNlbGVjdGVkSWcodGhpcy5pZ1NlbGVjdGlvbkZnLmNvbnRyb2xzWydzZWxlY3RlZElnTmFtZSddLnZhbHVlLCB0aGlzLmlnU2VsZWN0aW9uRmcuY29udHJvbHNbJ3NlbGVjdGVkSWdWZXJzaW9uJ10udmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaXNWYWxpZFJlc291cmNlID0gdHJ1ZTtcbiAgICB0aGlzLmhhc1Jlc3BvbnNlRGF0YSA9IGZhbHNlO1xuICAgIHRoaXMuc2VydmVyRXJyb3JMaXN0ID0gW107XG4gICAgdGhpcy5zZXJ2ZXJFcnJvclN0YXR1cyA9ICcnO1xuICAgIHRoaXMuc2VydmVyRXJyb3JEZXRlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuc2VydmVyVGltb3V0RGV0ZWN0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnNldmVyaXR5TGV2ZWxzRm9ybUNvbnRyb2wucGF0Y2hWYWx1ZSh0aGlzLnNldmVyaXR5TGV2ZWxzKTtcblxuICAgIHRoaXMudmFsaWRhdGlvbkVycm9yU3RyID0gdGhpcy5maGlyVmFsaWRhdG9yU2VydmljZS5nZXRVaVZhbGlkYXRpb25NZXNzYWdlcyhmaGlyUmVzb3VyY2UsIHJlc291cmNlRm9ybWF0LCB0aGlzLnNlbGVjdGVkSUcpO1xuXG4gICAgaWYodGhpcy52YWxpZGF0aW9uRXJyb3JTdHIpe1xuICAgICAgLy9zZWUgaWYgd2UgY2FuIGZpbmQgYW55IG9idmlvdXMgaXNzdWVzIHdpdGggdGhlIHJlc291cmNlIGhlcmVcbiAgICAgIHRoaXMuaXNWYWxpZFJlc291cmNlID0gZmFsc2U7XG4gICAgICB0aGlzLnZhbGlkYXRpb25GaW5pc2hlZCA9IHRydWU7XG4gICAgICB0aGlzLm9uVmFsaWRhdGlvbi5lbWl0KHtoYXNCYXNpY0Vycm9yczogdHJ1ZSwgaXNWYWxpZDogZmFsc2UsIHJlc291cmNlOiBmaGlyUmVzb3VyY2V9KTtcblxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIFRoZSBVSSB2YWxpZGF0aW9uIHBhc3NlZCBzdWNjZXNzZnVsbHksIGFuZCB3ZSBleGVjdXRlIHRoZSBiYWNrZW5kIHZhbGlkYXRpb24uXG4gICAgICB0aGlzLmV4ZWN1dGVBUElWYWxpZGF0aW9uKGZoaXJSZXNvdXJjZSwgcmVzb3VyY2VGb3JtYXQsIHRoaXMuc2VsZWN0ZWRJRz8uY2Fub25pY2FsVXJsKTtcbiAgICB9XG4gIH1cblxuICBvblBhc3RlRmhpclJlc291cmNlKGV2ZW50OiBDbGlwYm9hcmRFdmVudCkge1xuICAgIHRoaXMuZmlsZU5hbWUgPSAnJztcbiAgICBpZighdGhpcy5maGlyUmVzb3VyY2UpIHtcbiAgICAgIHRoaXMuY2xlYXJVSSgpO1xuICAgIH1cbiAgICBsZXQgdGV4dCA9IGV2ZW50LmNsaXBib2FyZERhdGE/LmdldERhdGEoJ3RleHQnKSA/PyAnJztcbiAgICBpZiAodGhpcy5maGlyVmFsaWRhdG9yU2VydmljZS5pc0pzb24odGV4dCkpIHtcbiAgICAgIHRoaXMucmVzb3VyY2VGb3JtYXQgPSAnanNvbic7XG4gICAgfSBlbHNlIGlmICh0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLmlzWG1sU3RyaW5nKHRleHQpKSB7XG4gICAgICB0aGlzLnJlc291cmNlRm9ybWF0ID0gJ3htbCc7XG4gICAgfVxuICB9XG5cbiAgZ2V0TGluZU51bWJlcnNCeVNldmVyaXR5KGFwaVJlc3BvbnNlOiBBcGlSZXNwb25zZSB8IG51bGwsIHNldmVyaXR5OiBzdHJpbmcpOiBudW1iZXJbXXtcbiAgICBpZighYXBpUmVzcG9uc2UgfHwgYXBpUmVzcG9uc2UuaXNzdWU/Lmxlbmd0aCA9PT0gMCl7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBhcGlSZXNwb25zZS5pc3N1ZVxuICAgICAgLmZpbHRlcihlbGVtZW50ID0+IGVsZW1lbnQuc2V2ZXJpdHkgPT0gc2V2ZXJpdHkpXG4gICAgICAuZmlsdGVyKGVsZW1lbnQgPT4gZWxlbWVudC5sb2NhdGlvbilcbiAgICAgIC5tYXAoZWxlbWVudCA9PiB0aGlzLmdldExpbmVOdW1iZXJGcm9tTG9jYXRpb24oZWxlbWVudC5sb2NhdGlvblswXSkgLSAxKTtcbiAgfTtcblxuICBzY3JvbGxUb0VsZW1lbnQobG9jYXRpb246IHN0cmluZyApOiB2b2lkIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihsb2NhdGlvbik7XG4gICAgaWYgKGVsZW1lbnQpIGVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnc3RhcnQnIH0pXG4gIH1cblxuICBnZXRMaW5lTnVtYmVyRnJvbUxvY2F0aW9uKGxvY2F0aW9uU3RyOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIC8vIEdldCB0aGUgbG9jYXRpb24gZnJvbSByZXNwb25zZVxuICAgIHJldHVybiAobG9jYXRpb25TdHI/Lmxlbmd0aCA+IDApID8gcGFyc2VJbnQgKGxvY2F0aW9uU3RyLnNwbGl0KFwiLFwiKVswXS5yZXBsYWNlKCAvXlxcRCsvZywgJycpKSA6IDA7XG4gIH1cblxuICAvLyBXaGVuIHRoZSB1c2VyIHNlbGVjdHMgYSBsb2NhdGlvbiBmcm9tIHRoZSBlcnJvcnMgYW5kIHdhcm5pbmcgcmVzdWx0cywgd2Ugd2FudCB0byBzY3JvbGwgdGhlIHBhZ2UgdG8gdGhhdCBsb2NhdGlvbi5cbiAgb25Mb2NhdGlvblNlbGVjdGVkKHJlc3BvbnNlOiBhbnkpOiB2b2lkIHtcbiAgICBsZXQgbG9jYXRpb25JZCA9ICgnI21hcmsnICsgdGhpcy5nZXRMaW5lTnVtYmVyRnJvbUxvY2F0aW9uKHJlc3BvbnNlLmxvY2F0aW9uWzBdKSkudG9Mb3dlckNhc2UoKTtcbiAgICB0aGlzLnNjcm9sbFRvRWxlbWVudChsb2NhdGlvbklkKTtcbiAgfVxuXG4gIC8vIFNlbmRzIGZoaXIgcmVzb3VyY2UgdG8gYmUgdmFsaWRhdGVkLCByZW5kZXJzIHJlc3BvbnNlXG5cbiAgcHJpdmF0ZSBleGVjdXRlQVBJVmFsaWRhdGlvbihmaGlyUmVzb3VyY2U6IGFueSwgcmVzb3VyY2VGb3JtYXQ6IHN0cmluZywgaWc6IHN0cmluZykge1xuICAgIC8vIFJlc2V0IHZhbHVlcyB0byBkZWZhdWx0IHN0YXRlIHByaW9yIHRvIHZhbGlkYXRpb24uXG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMucGFyc2VkRmhpclJlc291cmNlID0gJyc7XG4gICAgdGhpcy52YWxpZGF0aW9uRmluaXNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFwaVJlc3BvbnNlID0gbnVsbDtcblxuICAgIGlmKHRoaXMucmVzb3VyY2VGb3JtYXQgPT09IFwianNvblwiKXtcbiAgICAgIGZoaXJSZXNvdXJjZSA9IEpTT04ucGFyc2UoZmhpclJlc291cmNlKTtcbiAgICB9XG4gICAgZWxzZSBpZih0aGlzLnJlc291cmNlRm9ybWF0ID09PSBcInhtbFwiKXtcbiAgICAgIGxldCBmaGlyUmVzb3VyY2VYTUwgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGZoaXJSZXNvdXJjZSwgJ3RleHQveG1sJyk7XG4gICAgICBmaGlyUmVzb3VyY2UgPSBmaGlyUmVzb3VyY2VYTUwuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDtcbiAgICB9XG5cbiAgICB0aGlzLmZoaXJWYWxpZGF0b3JTZXJ2aWNlLnZhbGlkYXRlRmhpclJlc291cmNlKGZoaXJSZXNvdXJjZSwgcmVzb3VyY2VGb3JtYXQsIGlnKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIHRoaXMudmFsaWRhdGlvbkZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgICBsZXQgaXNzdWUgPSByZXNwb25zZS5pc3N1ZTtcbiAgICAgICAgICBpZihpc3N1ZS5sZW5ndGggPT09IDEgJiYgaXNzdWVbMF0uc2V2ZXJpdHkgPT09IFwiSW5mb3JtYXRpb25cIiAmJiBpc3N1ZVswXT8ubWVzc2FnZS50b0xvd2VyQ2FzZSgpID09PSBcIkFMTCBPS1wiLnRvTG93ZXJDYXNlKCkpe1xuICAgICAgICAgICAgdGhpcy5pc1ZhbGlkUmVzb3VyY2UgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5vblZhbGlkYXRpb24uZW1pdCh7aXNWYWxpZDogdHJ1ZSwgcmVzb3VyY2U6IGZoaXJSZXNvdXJjZX0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNWYWxpZFJlc291cmNlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnZhbGlkYXRpb25FcnJvclN0ciA9IFwiUGxlYXNlIHNlZSB0aGUgdmFsaWRhdGlvbiBlcnJvcnMgYmVsb3cuXCI7XG4gICAgICAgICAgICB0aGlzLnNldFZhbGlkYXRvclJlc3BvbnNlKHJlc3BvbnNlLCBmaGlyUmVzb3VyY2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFNvbWUgc3RyaW5ncyBwcm9kdWNlZCBieSB0aGUgdmFsaWRhdG9yIGFyZSBsb25nIGFuZCBtaXNzIHNwYWNlcy4gVGhpcyBjb3VsZCBicmVhayB0aGUgVUkgdmFsaWRhdGlvbiByZXBvcnQuXG4gICAgICAgICAgLy8gVGhlcmVmb3JlLCB3ZSBpbnNlcnQgYSBzcGFjZSBhZnRlciBlYWNoIGNvbWEgZm91bmQgaW4gdGhlIHZhbGlkYXRpb24gcmVzcG9uc2UgdGV4dC5cbiAgICAgICAgICBpc3N1ZS5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcbiAgICAgICAgICAgIGVsZW1lbnQuZGlhZ25vc3RpY3MgPSBlbGVtZW50LmRpYWdub3N0aWNzLnJlcGxhY2UoLywoPz1bXlxcc10pL2csIFwiLCBcIilcbiAgICAgICAgICB9KVxuXG5cbiAgICAgICAgICAvLyBzb3J0IGJ5IGxpbmUgbnVtYmVyc1xuICAgICAgICAgIGlzc3VlID0gaXNzdWUuc29ydCgoYTogYW55LCBiOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldExpbmVOdW1iZXJGcm9tTG9jYXRpb24oYS5sb2NhdGlvbj8uWzBdKSAtIHRoaXMuZ2V0TGluZU51bWJlckZyb21Mb2NhdGlvbihiLmxvY2F0aW9uPy5bMF0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gbWF0IGVhY2ggaXRlbSBvZiB0aGUgcmVzcG9uc2UgdG8gYW4gb2JqZWN0IGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgcmVzdWx0cyBhcmUgaW4gZXhwYW5kZWQgc3RhdGUgaW4gdGhlXG4gICAgICAgICAgLy8gVUkgdmFsaWRhdGlvbiByZXBvcnQuXG4gICAgICAgICAgdGhpcy5kYXRhU291cmNlLmRhdGEgPSBpc3N1ZS5tYXAoKGVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgbGV0IHJlc3VsdDogUmVzcG9uc2VJdGVtID0gT2JqZWN0LmFzc2lnbih7fSwgZWxlbWVudCk7XG4gICAgICAgICAgICByZXN1bHQuZXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5kYXRhU291cmNlLmZpbHRlclByZWRpY2F0ZSA9IHRoaXMuZ2V0RmlsdGVyUHJlZGljYXRlKCk7XG4gICAgICAgICAgdGhpcy5hcGlSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIHRoaXMuYXBpUmVzcG9uc2UhLmZvcm1hdHRlZFJlc291cmNlID0gcmVzcG9uc2U/LmV4dGVuc2lvbj8uWzBdPy52YWx1ZVN0cmluZztcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlcnIpID0+IHtcbiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuc2VydmVyRXJyb3JEZXRlY3RlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5zZXJ2ZXJFcnJvclN0YXR1cyA9IGVyci5zdGF0dXM7XG4gICAgICAgICAgaWYoZXJyPy5lcnJvcj8uaXNzdWUpe1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJFcnJvckxpc3QgPSBlcnIuZXJyb3IuaXNzdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMub25BcGlFcnJvci5lbWl0KGVycik7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICB9LFxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgLy9UT0RPIG1ha2Ugc3VyZSB0byByZW1vdmUgdGhpcyBmdW5jdGlvbiB3aGVuIHRoZSBzZXJ2ZXIgc2lkZSB0aW1lb3V0IGlzIGltcGxlbWVudGVkLlxuICAgIHNldFRpbWVvdXQoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmKHRoaXMuaXNMb2FkaW5nKSB7XG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnNlcnZlclRpbW91dERldGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcy5TRVJWRVJfVElNRU9VVF9JTlRFUlZBTFxuICAgICk7XG5cbiAgfVxuXG4gIHRvZ2dsZSgpIHtcbiAgICB0aGlzLmFsbEV4cGFuZGVkID0gIXRoaXMuYWxsRXhwYW5kZWQ7XG4gICAgdGhpcy5kYXRhU291cmNlLmRhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiBpdGVtLmV4cGFuZGVkID0gdGhpcy5hbGxFeHBhbmRlZCk7XG4gIH1cblxuICBvbkZpbHRlclJlc3VsdHMoKSB7XG4gICAgdGhpcy5kYXRhU291cmNlLmZpbHRlciA9IHRoaXMuc2V2ZXJpdHlMZXZlbHNGb3JtQ29udHJvbC52YWx1ZS5qb2luKCcsJyk7XG4gIH1cblxuICBnZXRGaWx0ZXJQcmVkaWNhdGUoKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChyb3c6IGFueSwgZmlsdGVyczogc3RyaW5nKSB7XG4gICAgICBsZXQgbWF0Y2hGaWx0ZXI6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICAgIGNvbnN0IGZpbHRlckFycmF5ID0gZmlsdGVycy5zcGxpdCgnLCcpO1xuICAgICAgZmlsdGVyQXJyYXkuZm9yRWFjaCgoZmlsdGVyOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBpZihyb3cuc2V2ZXJpdHkudG9Mb3dlckNhc2UoKS5pbmRleE9mKGZpbHRlci50b0xvd2VyQ2FzZSgpKSE9IC0xKXtcbiAgICAgICAgICAgIG1hdGNoRmlsdGVyID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIHJldHVybiBtYXRjaEZpbHRlcjtcbiAgICB9O1xuICB9XG5cbiAgb25DYW5jZWxWYWxpZGF0aW9uICgpe1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gIH1cblxuICBjaGVja0V4cGFuZENvbGxhcHNlQWxsU3RhdHVzKCkge1xuICAgIC8qXG4gICAgKiBXaGVuIGFsbCBlbGVtZW50cyBhcmUgY29sbGFwc2VkIHdlIHdhbnQgdG8gY2hhbmdlIHRoZSBleHBhbnNpb24gaWNvbiB0byByZW5kZXIgXCJleHBhbmQgYWxsXCJcbiAgICAqIFdoZW4gYWxsIGVsZW1lbnRzIGFyZSBleHBhbmRlZCB3ZSB3YW50IHRvIGNoYW5nZSB0aGUgZXhwYW5zaW9uIGljb24gdG8gXCJjb2xsYXBzZSBhbGxcIlxuICAgICogVGhpcyB3aWxsIHNhdmUgZXh0cmEgdW5uZWNlc3NhcnkgY2xpY2sgZm9yIHRoZSB1c2VyXG4gICAgKi9cbiAgICBjb25zdCBleHBhbmRlZEVsZW1lbnRzQ291bnQgPSB0aGlzLmRhdGFTb3VyY2UuZGF0YS5maWx0ZXIoZWxlbWVudCA9PiBlbGVtZW50WydleHBhbmRlZCddKS5sZW5ndGg7XG4gICAgaWYoZXhwYW5kZWRFbGVtZW50c0NvdW50ID09PSB0aGlzLmRhdGFTb3VyY2UuZGF0YS5sZW5ndGgpe1xuICAgICAgdGhpcy5hbGxFeHBhbmRlZCA9IHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYoZXhwYW5kZWRFbGVtZW50c0NvdW50ID09PSAwKXtcbiAgICAgIHRoaXMuYWxsRXhwYW5kZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpc0ZpbHRlckVuYWJsZWQoc2V2ZXJpdHk6IHN0cmluZykge1xuICAgIHJldHVybiAhIXRoaXMuZGF0YVNvdXJjZS5kYXRhLmZpbmQoKGVsZW1lbnQ6IGFueSkgPT4gZWxlbWVudC5zZXZlcml0eS50b0xvd2VyQ2FzZSgpID09PSBzZXZlcml0eS50b0xvd2VyQ2FzZSgpKTtcbiAgfVxuXG4gIGdldENvdW50KGxldmVsOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhU291cmNlLmRhdGFcbiAgICAgIC5maWx0ZXIoKGVsZW1lbnQ6IGFueSkgPT4gZWxlbWVudC5zZXZlcml0eS50b0xvd2VyQ2FzZSgpID09PSBsZXZlbC50b0xvd2VyQ2FzZSgpKVxuICAgICAgLmxlbmd0aDtcbiAgfVxuXG4gIG9uQ2xvc2VTZXJ2ZXJFcnJvck1lc3NhZ2UoKSB7XG4gICAgdGhpcy5zZXJ2ZXJFcnJvckRldGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5zZXJ2ZXJFcnJvckxpc3QgPSBbXTtcbiAgICB0aGlzLnNlcnZlckVycm9yU3RhdHVzID0gJyc7XG4gIH1cblxuICBwcml2YXRlIHNldFZhbGlkYXRvclJlc3BvbnNlKGFwaVJlc3BvbnNlOiBhbnksIHJlc291cmNlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBlcnJvcnNDb3VudCA9IGFwaVJlc3BvbnNlLmlzc3VlLmZpbHRlcigoZWxlbWVudDogYW55KSA9PiBlbGVtZW50LnNldmVyaXR5ID09ICdlcnJvcicpPy5sZW5ndGggPz8gMDtcbiAgICBjb25zdCB3YXJuaW5nc0NvdW50ID0gYXBpUmVzcG9uc2UuaXNzdWUuZmlsdGVyKChlbGVtZW50OiBhbnkpID0+IGVsZW1lbnQuc2V2ZXJpdHkgPT0gJ3dhcm5pbmcnKT8ubGVuZ3RoID8/IDA7XG4gICAgY29uc3QgaW5mb0NvdW50ID0gYXBpUmVzcG9uc2UuaXNzdWUuZmlsdGVyKChlbGVtZW50OiBhbnkpID0+IGVsZW1lbnQuc2V2ZXJpdHkgPT0gJ2luZm9ybWF0aW9uJyk/Lmxlbmd0aCA/PyAwO1xuICAgIGNvbnN0IG5vdGVzQ291bnQgPSBhcGlSZXNwb25zZS5pc3N1ZS5maWx0ZXIoKGVsZW1lbnQ6IGFueSkgPT4gZWxlbWVudC5zZXZlcml0eSA9PSAnbm90ZScpPy5sZW5ndGggPz8gMDtcblxuICAgIGxldCB2YWxpZGF0aW9uUmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0cyA9IHt9O1xuICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzQ291bnQgPSBlcnJvcnNDb3VudDtcbiAgICB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzQ291bnQgPSB3YXJuaW5nc0NvdW50O1xuICAgIHZhbGlkYXRpb25SZXN1bHQubm90ZXNDb3VudCA9IG5vdGVzQ291bnQ7XG4gICAgdmFsaWRhdGlvblJlc3VsdC5pbmZvQ291bnQgPSBpbmZvQ291bnQ7XG5cbiAgICB2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQgPSBlcnJvcnNDb3VudCA8PSAwO1xuICAgIHZhbGlkYXRpb25SZXN1bHQucmVzb3VyY2UgPSByZXNvdXJjZTtcbiAgICB0aGlzLm9uVmFsaWRhdGlvbi5lbWl0KHZhbGlkYXRpb25SZXN1bHQpO1xuICB9XG5cbiAgY2xlYXJWYWxpZGF0aW9uRXJyb3JzKCl7XG4gICAgdGhpcy52YWxpZGF0aW9uRXJyb3JTdHIgPSAnJztcbiAgICB0aGlzLmlzVmFsaWRSZXNvdXJjZSA9IGZhbHNlO1xuICAgIHRoaXMucGFyc2VkRmhpclJlc291cmNlID0gJyc7XG4gICAgdGhpcy5oYXNSZXNwb25zZURhdGEgPSBmYWxzZTtcbiAgICB0aGlzLnZhbGlkYXRpb25GaW5pc2hlZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5zZXJ2ZXJFcnJvckRldGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5zZXJ2ZXJFcnJvckxpc3QgPSBbXTtcbiAgICB0aGlzLnNlcnZlckVycm9yU3RhdHVzID0gJyc7XG4gICAgdGhpcy5zZXJ2ZXJUaW1vdXREZXRlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuYXBpUmVzcG9uc2UgPSBudWxsO1xuICB9XG5cbiAgZ2V0TGluZUl0ZW1DbGFzcyhpdGVtOiBzdHJpbmcsIGk6IG51bWJlcikge1xuXG4gICAgaWYodGhpcy5nZXRMaW5lTnVtYmVyc0J5U2V2ZXJpdHkodGhpcy5hcGlSZXNwb25zZSwgJ2Vycm9yJykuaW5kZXhPZihpKSAhPSAtMSl7XG4gICAgICB0aGlzLmhhc1Jlc3BvbnNlRGF0YSA9IHRydWU7XG4gICAgICByZXR1cm4gXCJlcnJvci1tYXJrXCI7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5nZXRMaW5lTnVtYmVyc0J5U2V2ZXJpdHkodGhpcy5hcGlSZXNwb25zZSwgJ3dhcm5pbmcnKS5pbmRleE9mKGkpICE9IC0xKXtcbiAgICAgIHRoaXMuaGFzUmVzcG9uc2VEYXRhID0gdHJ1ZTtcbiAgICAgIHJldHVybiBcIndhcm5pbmctbWFya1wiO1xuICAgIH1cbiAgICBlbHNlIGlmKHRoaXMuZ2V0TGluZU51bWJlcnNCeVNldmVyaXR5KHRoaXMuYXBpUmVzcG9uc2UsICdpbmZvcm1hdGlvbicpLmluZGV4T2YoaSkgIT0gLTEpe1xuICAgICAgdGhpcy5oYXNSZXNwb25zZURhdGEgPSB0cnVlO1xuICAgICAgcmV0dXJuIFwiaW5mby1tYXJrXCI7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5nZXRMaW5lTnVtYmVyc0J5U2V2ZXJpdHkodGhpcy5hcGlSZXNwb25zZSwgJ25vdGUnKS5pbmRleE9mKGkpICE9IC0xKXtcbiAgICAgIHRoaXMuaGFzUmVzcG9uc2VEYXRhID0gdHJ1ZTtcbiAgICAgIHJldHVybiBcIm5vdGUtbWFya1wiO1xuICAgIH1cblxuICAgIGVsc2UgcmV0dXJuJyc7XG4gIH1cblxuXG4gIGV4cG9ydFZhbGlkYXRpb25SZXN1bHRzKCkge1xuICAgIC8vIEFkZCB0aGUgZm9ybWF0dGVkIHJlc291cmNlIGZvcm0gdGhlIHZhbGlkYXRvciByZXNwb25zZSB0byBhIGpzb24gZmlsZVxuICAgIC8vIFRoaXMgd2F5IHRoZSBsaW5lIG51bWJlcnMgZnJvbSB0aGUgdmFsaWRhdG9yIHJlcG9ydCB3aWxsIG1hdGNoIHRoZSBqc29uIGZpbGUgbnVtYmVyc1xuICAgIGNvbnN0IGpzb25SZXNvdXJjZSA9IHRoaXM/LmFwaVJlc3BvbnNlPy5mb3JtYXR0ZWRSZXNvdXJjZSB8fCAnJztcbiAgICAvLyBDcmVhdGUgYSBwZGYgcmVwb3J0XG4gICAgY29uc3QgcmVzdWx0c0RhdGEgPSB0aGlzLmRhdGFTb3VyY2UuZGF0YVxuICAgICAgLm1hcChlbGVtZW50PT4geyByZXR1cm4ge3NldmVyaXR5OiBlbGVtZW50LnNldmVyaXR5LCBkaWFnbm9zdGljczogZWxlbWVudC5kaWFnbm9zdGljcywgbG9jYXRpb246IGVsZW1lbnQubG9jYXRpb24sIGZoaXJQYXRoOiBlbGVtZW50Py5leHByZXNzaW9uPy5bMF19fSlcbiAgICAgIC5maWx0ZXIoaXRlbSA9PiB0aGlzLnNldmVyaXR5TGV2ZWxzRm9ybUNvbnRyb2wudmFsdWUuaW5kZXhPZihpdGVtLnNldmVyaXR5KSAhPSAtMSk7XG4gICAgdGhpcy5vbkV4cG9ydFZhbGlkYXRpb25SZXN1bHRzLmVtaXQoe2pzb25SZXNvdXJjZToganNvblJlc291cmNlLCByZXN1bHRzRGF0YTogcmVzdWx0c0RhdGF9KTtcbiAgfVxuXG5cbiAgZ2V0SWdWZXJzaW9uc0xpc3Qoc2VsZWN0ZWRJZ05hbWU6IHN0cmluZywgaWdMaXN0OiBJbXBsZW1lbnRhdGlvbkd1aWRlW10pIHtcbiAgICB0aGlzLmlnVmVyc2lvbkRyb3Bkb3duTGlzdCA9IGlnTGlzdC5maWx0ZXIoZWw9PiBlbC5uYW1lPT0gc2VsZWN0ZWRJZ05hbWUpLm1hcCggZWw9PiBlbC52ZXJzaW9uKTtcbiAgICB0aGlzLnNlbGVjdGVkSWdWZXJzaW9uID0gdGhpcy5pZ1ZlcnNpb25MaXN0LmZpbmQoZWw9PiBlbCA9PSAnY3VycmVudCcpO1xuICAgIHRoaXMuc2VsZWN0ZWRJRyA9IHRoaXMuaWdMaXN0LmZpbmQoZWwgPT4gZWwubmFtZSA9PSBzZWxlY3RlZElnTmFtZSAmJiBlbC52ZXJzaW9uID09IHRoaXMuc2VsZWN0ZWRJZ1ZlcnNpb24pO1xuICAgIHRoaXMuaWdTZWxlY3Rpb25GZy5jb250cm9sc1snc2VsZWN0ZWRJZ1ZlcnNpb24nXS5wYXRjaFZhbHVlKHRoaXMuc2VsZWN0ZWRJZ1ZlcnNpb24pO1xuICB9XG5cbiAgc2V0U2VsZWN0ZWRJZyhzZWxlY3RlZElnTmFtZTogc3RyaW5nLCBzZWxlY3RlZElnVmVyc2lvbjogc3RyaW5nKSB7XG4gICAgdGhpcy5zZWxlY3RlZElHID0gdGhpcy5pZ0xpc3QuZmluZChlbCA9PiBlbC5uYW1lID09IHNlbGVjdGVkSWdOYW1lICYmIGVsLnZlcnNpb24gPT0gc2VsZWN0ZWRJZ1ZlcnNpb24pO1xuICB9XG59XG4iLCJAaWYgKGlzTG9hZGluZykge1xuICA8ZGl2IGNsYXNzPVwic3Bpbm5lci1jb250YWluZXJcIj5cbiAgICA8bWF0LXNwaW5uZXI+PC9tYXQtc3Bpbm5lcj5cbiAgPC9kaXY+XG59XG5cbkBpZiAodmFsaWRhdG9yVGl0bGUpIHtcbiAgPG1hdC1jYXJkLWhlYWRlciAgaWQ9XCJ2YWxpZGF0b3ItdGl0bGVcIj5cbiAgICA8bWF0LWNhcmQtdGl0bGU+e3sgdmFsaWRhdG9yVGl0bGUgfX08L21hdC1jYXJkLXRpdGxlPlxuICA8L21hdC1jYXJkLWhlYWRlcj5cbn1cblxuXG48IS0tIFRoZSBzZWN0aW9uIGJlbG93IHJlbmRlcnMgZXJyb3IgbWVzc2FnZXMgcmV0dXJuZWQgYnkgdGhlIHZhbGlkYXRvci4tLT5cbkBpZiAoc2VydmVyRXJyb3JEZXRlY3RlZCkge1xuICA8ZGl2IGNsYXNzPXNlcnZlci1lcnJvci1tZXNzYWdlLWNvbnRhaW5lcj5cbiAgICA8YnV0dG9uIG1hdC1idXR0b24gY2xhc3M9XCJjbG9zZS1idXR0b25cIiBjb2xvcj1cImFjY2VudFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiIGRpc2FibGVSaXBwbGVcbiAgICAgIChjbGljayk9XCJvbkNsb3NlU2VydmVyRXJyb3JNZXNzYWdlKClcIj5cbiAgICAgIDxtYXQtaWNvbj5jbG9zZTwvbWF0LWljb24+XG4gICAgPC9idXR0b24+XG4gICAgPGRpdiBjbGFzcz1cInNlcnZlci1lcnJvci1zdGF0dXNcIj48aDI+U2VydmVyIEVycm9yIFJlc3BvbnNlIFN0YXR1czoge3sgc2VydmVyRXJyb3JTdGF0dXMgfX08L2gyPjwvZGl2PlxuICAgIEBmb3IgKHNlcnZlckVycm9yIG9mIHNlcnZlckVycm9yTGlzdDsgdHJhY2sgc2VydmVyRXJyb3IpIHtcbiAgICAgIDxkaXYgY2xhc3M9XCJzZXJ2ZXItZXJyb3ItbWVzc2FnZS10ZXh0XCJcbiAgICAgIFtpbm5lclRleHRdPVwic2VydmVyRXJyb3IuZGlhZ25vc3RpY3NcIj48L2Rpdj5cbiAgICB9XG4gIDwvZGl2PlxufVxuXG48IS0tIFRPRE8gcmVtb3ZlIHRoaXMgY29kZSB3aGVuIHRoZSBBUEkgY29kZSBpcyB1cGRhdGVkIHRvIHJldHVybiA0MDggb24gcmVxdWVzdCB0aW1lb3V0IC0tPlxuQGlmIChzZXJ2ZXJUaW1vdXREZXRlY3RlZCkge1xuICA8ZGl2IGNsYXNzPXNlcnZlci1lcnJvci1tZXNzYWdlLWNvbnRhaW5lcj5cbiAgICA8YnV0dG9uIG1hdC1idXR0b24gY2xhc3M9XCJjbG9zZS1idXR0b25cIiBjb2xvcj1cImFjY2VudFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiIGRpc2FibGVSaXBwbGVcbiAgICAgIChjbGljayk9XCJzZXJ2ZXJUaW1vdXREZXRlY3RlZCA9IGZhbHNlXCI+XG4gICAgICA8bWF0LWljb24+Y2xvc2U8L21hdC1pY29uPlxuICAgIDwvYnV0dG9uPlxuICAgIDxkaXYgY2xhc3M9XCJzZXJ2ZXItZXJyb3Itc3RhdHVzXCI+PGgyPlNlcnZlciBUaW1lb3V0IEVycm9yLjwvaDI+PC9kaXY+XG4gIDwvZGl2PlxufVxuXG48IS0tQWN0aW9ucyBhdmFpbGFibGUgYWJvdmUgdGhlIEZISVIgdmFsaWRhdG9yIGlucHV0IHRleHRhcmVhLS0+XG48ZGl2IGNsYXNzPVwicm93LWJ1dHRvbi13cmFwcGVyXCI+XG5cbiAgPCEtLVNlbGVjdCBKU09OL1hNTCByYWRpbyBncm91cC0tPlxuICBAaWYgKHZhbGlkYXRpb25JbnB1dEZvcm1hdC5mb3JtYXQgPT0gJ3htbCBhbmQganNvbicpIHtcbiAgICA8bWF0LXJhZGlvLWdyb3VwIFsobmdNb2RlbCldPVwicmVzb3VyY2VGb3JtYXRcIiBbZGlzYWJsZWRdPWlzTG9hZGluZyA+XG4gICAgICA8bWF0LXJhZGlvLWJ1dHRvblxuICAgICAgICB2YWx1ZT1cImpzb25cIlxuICAgICAgICBbY2hlY2tlZF09XCJyZXNvdXJjZUZvcm1hdCA9PSdqc29uJ1wiXG4gICAgICAgIChzZWxlY3QpPVwicmVzb3VyY2VGb3JtYXQgPSAnanNvbidcIj5cbiAgICAgICAgSlNPTlxuICAgICAgPC9tYXQtcmFkaW8tYnV0dG9uPlxuICAgICAgPG1hdC1yYWRpby1idXR0b25cbiAgICAgICAgdmFsdWU9XCJ4bWxcIlxuICAgICAgICBbY2hlY2tlZF09XCJyZXNvdXJjZUZvcm1hdCA9PSd4bWwnXCJcbiAgICAgICAgKHNlbGVjdCk9XCJyZXNvdXJjZUZvcm1hdCA9ICd4bWwnXCI+XG4gICAgICAgIFhNTFxuICAgICAgPC9tYXQtcmFkaW8tYnV0dG9uPlxuICAgIDwvbWF0LXJhZGlvLWdyb3VwPlxuICB9XG5cbiAgQGlmKGlnTGlzdD8ubGVuZ3RoID4gMSl7XG4gICAgPGZvcm0gW2Zvcm1Hcm91cF09XCJpZ1NlbGVjdGlvbkZnXCI+XG4gICAgPG1hdC1mb3JtLWZpZWxkIGFwcGVhcmFuY2U9XCJvdXRsaW5lXCIgY2xhc3M9XCJtYXJnaW4tbGVmdC1tZCBtYXJnaW4tdG9wLW1kIG1hcmdpbi1yaWdodC1tZFwiPlxuICAgICAgPG1hdC1sYWJlbD5TZWxlY3QgSUc8L21hdC1sYWJlbD5cbiAgICAgIDxtYXQtc2VsZWN0IGZvcm1Db250cm9sTmFtZT1cInNlbGVjdGVkSWdOYW1lXCI+XG4gICAgICAgIEBmb3IgKGlnTmFtZSBvZiBpZ05hbWVMaXN0OyB0cmFjayBpZ05hbWUpIHtcbiAgICAgICAgICA8bWF0LW9wdGlvbiBbdmFsdWVdPVwiaWdOYW1lXCI+XG4gICAgICAgICAgICB7eyBpZ05hbWUgfX1cbiAgICAgICAgICA8L21hdC1vcHRpb24+XG4gICAgICAgIH1cbiAgICAgIDwvbWF0LXNlbGVjdD5cbiAgICAgIEBpZiAoaWdTZWxlY3Rpb25GZy5pbnZhbGlkKSB7XG4gICAgICAgIDxtYXQtZXJyb3I+U2VsZWN0IEltcGxlbWVudGF0aW9uIEd1aWRlPC9tYXQtZXJyb3I+XG4gICAgICB9XG4gICAgPC9tYXQtZm9ybS1maWVsZD5cblxuICAgIDxtYXQtZm9ybS1maWVsZCBhcHBlYXJhbmNlPVwib3V0bGluZVwiIGNsYXNzPVwibWFyZ2luLWxlZnQtbWQgbWFyZ2luLXRvcC1tZCBtYXJnaW4tcmlnaHQtbWRcIj5cbiAgICAgIDxtYXQtbGFiZWw+U2VsZWN0IElHIFZlcnNpb248L21hdC1sYWJlbD5cbiAgICAgIDxtYXQtc2VsZWN0IFtkaXNhYmxlZF09XCIhc2VsZWN0ZWRJZ05hbWVcIiBmb3JtQ29udHJvbE5hbWU9XCJzZWxlY3RlZElnVmVyc2lvblwiPlxuICAgICAgICBAZm9yIChpZ1ZlcnNpb24gb2YgaWdWZXJzaW9uRHJvcGRvd25MaXN0OyB0cmFjayBpZ1ZlcnNpb24pIHtcbiAgICAgICAgICA8bWF0LW9wdGlvbiBbdmFsdWVdPVwiaWdWZXJzaW9uXCI+XG4gICAgICAgICAgICB7e2lnVmVyc2lvbn19XG4gICAgICAgICAgPC9tYXQtb3B0aW9uPlxuICAgICAgICB9XG4gICAgICA8L21hdC1zZWxlY3Q+XG4gICAgPC9tYXQtZm9ybS1maWVsZD5cbiAgICA8L2Zvcm0+XG4gIH1cblxuICBAaWYgKHZhbGlkYXRpb25JbnB1dEZvcm1hdD8uZm9ybWF0ID09ICd4bWwgYW5kIGpzb24nKSB7XG4gICAgPHNwYW4gY2xhc3M9XCJjb250ZW50LXNwYWNlclwiPjwvc3Bhbj5cbiAgfVxuXG4gIDwhLS1GaWxlIHVwbG9hZCB3aWRnZXQtLT5cbiAgPGlucHV0IHR5cGU9XCJmaWxlXCIgY2xhc3M9XCJmaWxlLWlucHV0XCIgKGNsaWNrKT1cImZpbGVVcGxvYWQudmFsdWU9bnVsbFwiXG4gICAgW2FjY2VwdF09XCJ2YWxpZGF0aW9uSW5wdXRGb3JtYXQ/LmFjY2VwdHM/LnRvU3RyaW5nKClcIlxuICAgIChjaGFuZ2UpPVwib25GaWxlU2VsZWN0ZWQoJGV2ZW50KVwiICNmaWxlVXBsb2FkPlxuXG4gIEBpZiAodmFsaWRhdGlvbklucHV0Rm9ybWF0LmZvcm1hdCA9PSAneG1sIGFuZCBqc29uJykge1xuICAgIDxzcGFuIGNsYXNzPVwiZmlsZW5hbWVcIj57e2ZpbGVOYW1lfX08L3NwYW4+XG4gIH1cblxuICA8YnV0dG9uIG1hdC1yYWlzZWQtYnV0dG9uIFtzdHlsZS5iYWNrZ3JvdW5kLWNvbG9yXT1cImJ1dHRvbkJhY2tncm91bmRDb2xvclwiIFtzdHlsZS5jb2xvcl09XCJidXR0b25UeHRDb2xvclwiXG4gICAgY2xhc3M9XCJ1cGxvYWQtYnRuXCJcbiAgICAoY2xpY2spPVwiY2xlYXJVSSgpOyBmaWxlVXBsb2FkLmNsaWNrKCk7XCIgW2Rpc2FibGVkXT1pc0xvYWRpbmc+XG4gICAgPG1hdC1pY29uPnVwbG9hZDwvbWF0LWljb24+XG4gICAgVXBsb2FkXG4gIDwvYnV0dG9uPlxuXG4gIEBpZiAoISh2YWxpZGF0aW9uSW5wdXRGb3JtYXQuZm9ybWF0ID09ICd4bWwgYW5kIGpzb24nKSkge1xuICAgIDxzcGFuIGNsYXNzPVwiZmlsZW5hbWVcIj57e2ZpbGVOYW1lfX08L3NwYW4+XG4gIH1cbjwvZGl2PlxuXG48IS0tIEZISVIgdmFsaWRhdG9yIHRleHQgZWRpdG9yLS0+XG48ZGl2IGNsYXNzPVwidGV4dGFyZWEtd3JhcHBlclwiPlxuICA8ZGl2IGNsYXNzPVwibGluZS1udW1iZXJzXCIgI251bWJlcnM+XG4gICAgQGZvciAoaSBvZiBnZXRMaW5lTnVtYmVycygpOyB0cmFjayBpKSB7XG4gICAgICA8ZGl2IGNsYXNzPVwibnVtYmVyc1wiPnt7aX19PC9kaXY+XG4gICAgfVxuICA8L2Rpdj5cbiAgPHRleHRhcmVhXG4gICAgI3ZhbGlkYXRvcklucHV0XG4gICAgcm93cz1cIjMwXCJcbiAgICBbKG5nTW9kZWwpXT1cImZoaXJSZXNvdXJjZVwiXG4gICAgKG5nTW9kZWxDaGFuZ2UpPVwib25SZXNvdXJjZUNvbnRlbnRDaGFuZ2VkLmVtaXQoZmhpclJlc291cmNlKVwiXG4gICAgW25nU3R5bGVdPVwieydib3JkZXItY29sb3InOiAoISF2YWxpZGF0aW9uRXJyb3JTdHIgJiYgdmFsaWRhdGlvbkVycm9yU3RyICE9ICdQbGVhc2Ugc2VsZWN0IGFuIEltcGxlbWVudGF0aW9uIEd1aWRlJykgPyAncmVkJzogbnVsbCB9XCJcbiAgICAocGFzdGUpPVwib25QYXN0ZUZoaXJSZXNvdXJjZSgkZXZlbnQpXCJcbiAgICBbZGlzYWJsZWRdPVwiaXNMb2FkaW5nXCJcbiAgICAoaW5wdXQpPVwibGluZU51bWJlcnMoKVwiXG4gICAgKHNjcm9sbCk9XCJudW1iZXJzLnNjcm9sbFRvcCA9IHZhbGlkYXRvcklucHV0LnNjcm9sbFRvcFwiXG4gICAgPlxuICA8L3RleHRhcmVhPlxuPC9kaXY+XG5cbjwhLS1BY3Rpb25zIGF2YWlsYWJsZSBiZWxvdyB0aGUgRkhJUiB2YWxpZGF0b3IgaW5wdXQgdGV4dGFyZWEtLT5cbkBpZiAoZm9ybWF0UmVzb3VyY2VCdG5TaG93biB8fCBjbGVhclZhbGlkYXRvckJ0blNob3duIHx8IHN1Ym1pdEJ0blNob3duIHx8IHZhbGlkYXRpb25FcnJvclN0cikge1xuICA8ZGl2IGNsYXNzPVwicm93LWJ1dHRvbi13cmFwcGVyXCI+XG4gICAgQGlmIChzdWJtaXRCdG5TaG93biAmJiAoc3VibWl0QnRuQWxpZ25tZW50PT0nbGVmdCcpICYmICFpc0xvYWRpbmcpIHtcbiAgICAgIDxzcGFuPlxuICAgICAgICA8YnV0dG9uIG1hdC1yYWlzZWQtYnV0dG9uIFtzdHlsZS5iYWNrZ3JvdW5kLWNvbG9yXT1cImJ1dHRvbkJhY2tncm91bmRDb2xvclwiIFtzdHlsZS5jb2xvcl09XCJidXR0b25UeHRDb2xvclwiIGNsYXNzPVwiYnV0dG9uXCJcbiAgICAgICAgICAoY2xpY2spPVwidmFsaWRhdGVGaGlyUmVzb3VyY2UoZmhpclJlc291cmNlLCByZXNvdXJjZUZvcm1hdClcIj5cbiAgICAgICAgICA8bWF0LWljb24+c2VuZDwvbWF0LWljb24+XG4gICAgICAgICAgU3VibWl0XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9zcGFuPlxuICAgIH1cbiAgICBAaWYgKGZvcm1hdFJlc291cmNlQnRuU2hvd24gJiYgIWlzTG9hZGluZykge1xuICAgICAgPGJ1dHRvbiBbbmdDbGFzc109XCJ7J2xlZnQtbWFyZ2luLXNwYWNlcic6IHN1Ym1pdEJ0bkFsaWdubWVudD09J2xlZnQnfVwiIG1hdC1yYWlzZWQtYnV0dG9uXG4gICAgICAgIFtzdHlsZS5iYWNrZ3JvdW5kLWNvbG9yXT1cImJ1dHRvbkJhY2tncm91bmRDb2xvclwiIFtzdHlsZS5jb2xvcl09XCJidXR0b25UeHRDb2xvclwiXG4gICAgICAgIChjbGljayk9XCJvbkZvcm1hdElucHV0KCk7XCJcbiAgICAgICAgW2Rpc2FibGVkXT1cIiFmaGlyUmVzb3VyY2VcIj5cbiAgICAgICAgPG1hdC1pY29uPmNvZGU8L21hdC1pY29uPlxuICAgICAgICBGb3JtYXQgSW5wdXRcbiAgICAgIDwvYnV0dG9uPlxuICAgIH1cbiAgICA8c3BhbiBjbGFzcz1cImNvbnRlbnQtc3BhY2VyXCI+PC9zcGFuPlxuICAgIEBpZiAodmFsaWRhdGlvbkZpbmlzaGVkKSB7XG4gICAgICA8c3BhbiBpZD1cImVycm9yLXJlc3BvbnNlXCI+XG4gICAgICAgIEBpZiAoISF2YWxpZGF0aW9uRXJyb3JTdHIgJiYgIWlzVmFsaWRSZXNvdXJjZSkge1xuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZGFuZ2VyLWNvbG9yXCI+e3t2YWxpZGF0aW9uRXJyb3JTdHJ9fTwvc3Bhbj5cbiAgICAgICAgfVxuICAgICAgICBAaWYgKGlzVmFsaWRSZXNvdXJjZSkge1xuICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3VjY2Vzcy1jb2xvclwiPiBUaGlzIGlzIGEgdmFsaWQgRkhJUiByZXNvdXJjZS48L3NwYW4+XG4gICAgICAgIH1cbiAgICAgIDwvc3Bhbj5cbiAgICB9XG4gICAgPHNwYW4gY2xhc3M9XCJjb250ZW50LXNwYWNlclwiPjwvc3Bhbj5cbiAgICBAaWYgKGNsZWFyVmFsaWRhdG9yQnRuU2hvd24gJiYgIWlzTG9hZGluZykge1xuICAgICAgPGJ1dHRvblxuICAgICAgICBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cInN1Y2Nlc3NcIiBjbGFzcz1cImJ1dHRvblwiXG4gICAgICAgIChjbGljayk9XCJvbkNsZWFyKClcIj5cbiAgICAgICAgPG1hdC1pY29uPmNsZWFyPC9tYXQtaWNvbj5cbiAgICAgICAgQ2xlYXIgVmFsaWRhdG9yXG4gICAgICA8L2J1dHRvbj5cbiAgICB9XG4gICAgQGlmIChzdWJtaXRCdG5TaG93biAmJiAoc3VibWl0QnRuQWxpZ25tZW50ID09J3JpZ2h0JykgJiYgIWlzTG9hZGluZykge1xuICAgICAgPHNwYW4gY2xhc3M9XCJsZWZ0LW1hcmdpbi1zcGFjZXJcIj5cbiAgICAgICAgPGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cImFjY2VudFwiIGNsYXNzPVwiYnV0dG9uXCJcbiAgICAgICAgICAoY2xpY2spPVwidmFsaWRhdGVGaGlyUmVzb3VyY2UoZmhpclJlc291cmNlLCByZXNvdXJjZUZvcm1hdClcIj5cbiAgICAgICAgICA8bWF0LWljb24+c2VuZDwvbWF0LWljb24+XG4gICAgICAgICAge3sgc3VibWl0QnRuVGl0bGV9fVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvc3Bhbj5cbiAgICB9XG4gIDwvZGl2PlxufVxuXG5AaWYgKGlzTG9hZGluZyAmJiBjYW5jZWxWYWxpZGF0aW9uQnRuU2hvd24pIHtcbiAgPGRpdiBjbGFzcz1cInJvdy1idXR0b24td3JhcHBlciBwYWRkaW5nLXRvcC1tZFwiPlxuICAgIDxzcGFuIGNsYXNzPVwiY29udGVudC1zcGFjZXJcIj48L3NwYW4+XG4gICAgPGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiBjb2xvcj1cIndhcm5cIiAoY2xpY2spPVwib25DYW5jZWxWYWxpZGF0aW9uKClcIj5cbiAgICAgIDxtYXQtaWNvbj5jYW5jZWw8L21hdC1pY29uPlxuICAgICAgQ2FuY2VsIFZhbGlkYXRpb25cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG59XG5cbjwhLS0gQWN0aW9ucyBhdmFpbGFibGUgYWZ0ZXIgdmFsaWRhdG9yIGhhcyBwcm9jZXNzZWQgZGF0YS0tPlxuXG5AaWYgKGFwaVJlc3BvbnNlPy5pc3N1ZSAmJiAhaXNMb2FkaW5nKSB7XG4gIDxkaXY+XG4gICAgPGRpdiBjbGFzcz1cInBhZGRpbmctdG9wLW1kXCI+XG4gICAgICA8ZGl2IChjbGljayk9XCJvbkZpbHRlclJlc3VsdHMoKVwiPlxuICAgICAgICA8bWF0LWJ1dHRvbi10b2dnbGUtZ3JvdXAgbmFtZT1cInNldmVyaXR5IGxldmVsIGZpbHRlclwiIFtmb3JtQ29udHJvbF09XCJzZXZlcml0eUxldmVsc0Zvcm1Db250cm9sXCJcbiAgICAgICAgICBhcmlhLWxhYmVsPVwic2V2ZXJpdHkgbGV2ZWwgZmlsdGVyXCIgbXVsdGlwbGUgY2xhc3M9XCJmdWxsLXdpZHRoXCI+XG4gICAgICAgICAgQGZvciAobGV2ZWwgb2Ygc2V2ZXJpdHlMZXZlbHM7IHRyYWNrIGxldmVsKSB7XG4gICAgICAgICAgICA8bWF0LWJ1dHRvbi10b2dnbGVcbiAgICAgICAgICAgICAgaWQ9XCJmb3JtYXQtdG9nZ2xlLWJ1dHRvbnNcIlxuICAgICAgICAgICAgICBbdmFsdWVdPVwibGV2ZWxcIlxuICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiIWlzRmlsdGVyRW5hYmxlZChsZXZlbClcIj5cbiAgICAgICAgICAgICAgPCEtLSBJbiBvcmRlciB0byBzeW5jaHJvbmlzZSB0aGUgc3RhdGUgb2YgdGhlIGJ1dHRvbiB3aXRoIHRoZSBzdGF0ZSBvZiB0aGUgY2hlY2tib3gsIHdlIHNpbXBseSBzaG93IG9yIGhpZGVcbiAgICAgICAgICAgICAgc2VsZWN0ZWQgb3IgZGVzZWxlY3RlZCBjaGVja2JveC4tLT5cbiAgICAgICAgICAgICAgQGlmIChzZXZlcml0eUxldmVsc0Zvcm1Db250cm9sPy52YWx1ZS5pbmRleE9mKGxldmVsKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIDxtYXQtY2hlY2tib3hcbiAgICAgICAgICAgICAgICAgIGNvbG9yPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICBbY2hlY2tlZF09dHJ1ZVxuICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cIiFpc0ZpbHRlckVuYWJsZWQobGV2ZWwpXCJcbiAgICAgICAgICAgICAgICAgIFtkaXNhYmxlUmlwcGxlXT1cInRydWVcIlxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDwvbWF0LWNoZWNrYm94PlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIEBpZiAoc2V2ZXJpdHlMZXZlbHNGb3JtQ29udHJvbD8udmFsdWUuaW5kZXhPZihsZXZlbCkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgPG1hdC1jaGVja2JveFxuICAgICAgICAgICAgICAgICAgY29sb3I9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICAgIFtjaGVja2VkXT1mYWxzZVxuICAgICAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cIiFpc0ZpbHRlckVuYWJsZWQobGV2ZWwpXCJcbiAgICAgICAgICAgICAgICAgIFtkaXNhYmxlUmlwcGxlXT1cInRydWVcIlxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDwvbWF0LWNoZWNrYm94PlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHt7bGV2ZWwgfCB0aXRsZWNhc2UgfX0gKHt7Z2V0Q291bnQobGV2ZWwpfX0pXG4gICAgICAgICAgICA8L21hdC1idXR0b24tdG9nZ2xlPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9tYXQtYnV0dG9uLXRvZ2dsZS1ncm91cD5cbiAgICAgIDwvZGl2PlxuICAgICAgQGlmICh2YWxpZGF0aW9uUmVzdWx0c0V4cGFuZGVkKSB7XG4gICAgICAgIDxkaXYgY2xhc3M9XCJwYWRkaW5nLXRvcC1tZCBib3hcIj5cbiAgICAgICAgICBAaWYgKCFyZXN1bHREZXRhaWxzRXhwYW5kQnRuU2hvd24pIHtcbiAgICAgICAgICAgIDxidXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9cHJpbWFyeSAoY2xpY2spPVwicmVzdWx0RGV0YWlsc0V4cGFuZEJ0blNob3duID0gdHJ1ZVwiPlxuICAgICAgICAgICAgICA8bWF0LWljb24+ZXhwYW5kX21vcmU8L21hdC1pY29uPiBFeHBhbmQgVmFsaWRhdGlvbiBSZXN1bHRzXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICB9XG4gICAgICAgICAgQGlmIChyZXN1bHREZXRhaWxzRXhwYW5kQnRuU2hvd24pIHtcbiAgICAgICAgICAgIDxidXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9cHJpbWFyeSAoY2xpY2spPVwicmVzdWx0RGV0YWlsc0V4cGFuZEJ0blNob3duID0gZmFsc2VcIj5cbiAgICAgICAgICAgICAgPG1hdC1pY29uPmV4cGFuZF9sZXNzPC9tYXQtaWNvbj4gQ29sbGFwc2UgVmFsaWRhdGlvbiBSZXN1bHRzXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICB9XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJjb250ZW50LXNwYWNlclwiPjwvc3Bhbj5cbiAgICAgICAgICBAaWYgKGV4cG9ydFJlc3VsdHNCdXR0b25TaG93bikge1xuICAgICAgICAgICAgPGJ1dHRvbiBtYXQtcmFpc2VkLWJ1dHRvbiAoY2xpY2spPVwiZXhwb3J0VmFsaWRhdGlvblJlc3VsdHMoKVwiIGNvbG9yPVwiYWNjZW50XCJcbiAgICAgICAgICAgICAgW2Rpc2FibGVkXT1cIiEoZGF0YVNvdXJjZT8uZGF0YT8ubGVuZ3RoPjApXCI+XG4gICAgICAgICAgICAgIDxtYXQtaWNvbj5mb2xkZXJfemlwPC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAge3tleHBvcnRWYWxpZGF0aW9uUmVzdWx0c0J0bk5hbWV9fVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICAgIEBpZiAoc2V2ZXJpdHlMZXZlbHNGb3JtQ29udHJvbD8udmFsdWU/Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICA8ZGl2PlxuICAgICAgICAgIFBsZWFzZSBzZWxlY3Qgc2V2ZXJpdHkgbGV2ZWwgdG8gc2VlIHRoZSByZXN1bHQuXG4gICAgICAgIDwvZGl2PlxuICAgICAgfVxuICAgICAgQGlmICgoIXZhbGlkYXRpb25SZXN1bHRzRXhwYW5kZWQpICYmIGV4cG9ydFJlc3VsdHNCdXR0b25TaG93bikge1xuICAgICAgICA8ZGl2IGNsYXNzPVwicGFkZGluZy10b3AtbWQgYm94IG1hcmdpbi1ib3R0b20tbWRcIj5cbiAgICAgICAgICA8YnV0dG9uIG1hdC1yYWlzZWQtYnV0dG9uIChjbGljayk9XCJleHBvcnRWYWxpZGF0aW9uUmVzdWx0cygpXCIgY29sb3I9XCJhY2NlbnRcIlxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cIiEoZGF0YVNvdXJjZT8uZGF0YT8ubGVuZ3RoPjApXCIgY2xhc3M9XCJtYXJnaW4tbGVmdC1tZFwiPlxuICAgICAgICAgICAgPG1hdC1pY29uPmZvbGRlcl96aXA8L21hdC1pY29uPlxuICAgICAgICAgICAge3tleHBvcnRWYWxpZGF0aW9uUmVzdWx0c0J0bk5hbWV9fVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICAgIEBpZiAoc2V2ZXJpdHlMZXZlbHNGb3JtQ29udHJvbD8udmFsdWU/Lmxlbmd0aCA+IDAgJiYgcmVzdWx0RGV0YWlsc0V4cGFuZEJ0blNob3duKSB7XG4gICAgICAgIDx0YWJsZVxuICAgICAgICAgIG1hdC10YWJsZSBbZGF0YVNvdXJjZV09XCJkYXRhU291cmNlXCIgbXVsdGlUZW1wbGF0ZURhdGFSb3dzXG4gICAgICAgICAgPlxuICAgICAgICAgIDwhLS0gRmlyc3QgY29sdW1uIGNvbnRhaW5zIGV4cGFuZC9jb2xsYXBzZSB3aWRnZXQuIFRoZSB1c2VyIGNhbiBjaG9zZSB0byBleHBhbmQvY29sbGFwc2UgYWxsIHJvd3MsXG4gICAgICAgICAgYXMgd2VsbCBhcyBleHBhbmQvY29sbGFwc2UgaW5kaXZpZHVhbCByb3dzLiBOb3RlIHRoYXQgdGhlIGV4cGFuZC9jb2xsYXBzZSBhbGwgY2FuIGJlIHRvZ2dsZWQgYXV0b21hdGljYWxseVxuICAgICAgICAgIGJhc2VkIHRoZSBzdGF0ZSBvZiB0aGUgaW5kaXZpZHVhbCBleHBhbmQvY29sbGFwc2Ugcm93cy4gRm9yIGV4YW1wbGUgaWYgYWxsIHJvd3MgYXJlIGV4cGFuZGVkIGFuZCBcImV4cGFuZCBhbGxcIlxuICAgICAgICAgIGlzIHJlbmRlcmVkLCB3ZSBhdXRvbWF0aWNhbGx5IGhpZGUgaXQgZW5kIHJlbmRlciBcImNvbGxhcHNlIGFsbFwiIC0tPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwidG9nZ2xlXCI+XG4gICAgICAgICAgICA8dGggbWF0LWhlYWRlci1jZWxsICptYXRIZWFkZXJDZWxsRGVmIChjbGljayk9XCJ0b2dnbGUoKVwiPlxuICAgICAgICAgICAgICBAaWYgKCFhbGxFeHBhbmRlZCkge1xuICAgICAgICAgICAgICAgIDxtYXQtaWNvbiBjbGFzcz1cInBvaW50ZXJcIiBtYXRUb29sdGlwPVwiRXhwYW5kIEFsbFwiIGFyaWEtbGFiZWw9XCJleHBhbmQgYWxsXCI+XG4gICAgICAgICAgICAgICAgICBleHBhbmRfbW9yZVxuICAgICAgICAgICAgICAgIDwvbWF0LWljb24+XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgQGlmIChhbGxFeHBhbmRlZCkge1xuICAgICAgICAgICAgICAgIDxtYXQtaWNvbiBjbGFzcz1cInBvaW50ZXJcIiBtYXRUb29sdGlwPVwiQ29sbGFwc2UgQWxsXCIgYXJpYS1sYWJlbD1cImNvbGxhcHNlIGFsbFwiPlxuICAgICAgICAgICAgICAgICAgZXhwYW5kX2xlc3NcbiAgICAgICAgICAgICAgICA8L21hdC1pY29uPlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHZhbGlkYXRpb25SZXN1bHRJdGVtXCIgY2xhc3M9XCJwb2ludGVyXCJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cInZhbGlkYXRpb25SZXN1bHRJdGVtLmV4cGFuZGVkID0gIXZhbGlkYXRpb25SZXN1bHRJdGVtLmV4cGFuZGVkOyBjaGVja0V4cGFuZENvbGxhcHNlQWxsU3RhdHVzKClcIj5cbiAgICAgICAgICAgICAgQGlmICghdmFsaWRhdGlvblJlc3VsdEl0ZW0uZXhwYW5kZWQpIHtcbiAgICAgICAgICAgICAgICA8bWF0LWljb24gYXJpYS1sYWJlbD1cImV4cGFuZFwiPlxuICAgICAgICAgICAgICAgICAgZXhwYW5kX21vcmVcbiAgICAgICAgICAgICAgICA8L21hdC1pY29uPlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIEBpZiAodmFsaWRhdGlvblJlc3VsdEl0ZW0uZXhwYW5kZWQpIHtcbiAgICAgICAgICAgICAgICA8bWF0LWljb24gYXJpYS1sYWJlbD1cImNvbGxhcHNlXCI+XG4gICAgICAgICAgICAgICAgICBleHBhbmRfbGVzc1xuICAgICAgICAgICAgICAgIDwvbWF0LWljb24+XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPCEtLSBTZXZlcml0eSBsZXZlbCBpY29ucyAtLT5cbiAgICAgICAgICA8bmctY29udGFpbmVyIG1hdENvbHVtbkRlZj1cImljb25cIj5cbiAgICAgICAgICAgIDx0aCBtYXQtaGVhZGVyLWNlbGwgKm1hdEhlYWRlckNlbGxEZWY+PC90aD5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCB2YWxpZGF0aW9uUmVzdWx0SXRlbVwiPlxuICAgICAgICAgICAgICBAaWYgKHZhbGlkYXRpb25SZXN1bHRJdGVtLnNldmVyaXR5ID09PSAnRXJyb3InKSB7XG4gICAgICAgICAgICAgICAgPG1hdC1pY29uXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cImRhbmdlci1jb2xvclwiPmVycm9yXG4gICAgICAgICAgICAgICAgPC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBAaWYgKHZhbGlkYXRpb25SZXN1bHRJdGVtLnNldmVyaXR5ID09PSAnV2FybmluZycpIHtcbiAgICAgICAgICAgICAgICA8bWF0LWljb25cbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwid2FybmluZy1jb2xvclwiPndhcm5pbmdcbiAgICAgICAgICAgICAgICA8L21hdC1pY29uPlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIEBpZiAodmFsaWRhdGlvblJlc3VsdEl0ZW0uc2V2ZXJpdHkgPT09ICdJbmZvcm1hdGlvbicpIHtcbiAgICAgICAgICAgICAgICA8bWF0LWljb25cbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwic3VjY2Vzcy1jb2xvclwiPmluZm9cbiAgICAgICAgICAgICAgICA8L21hdC1pY29uPlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIEBpZiAodmFsaWRhdGlvblJlc3VsdEl0ZW0uc2V2ZXJpdHkgPT09ICdOb3RlJykge1xuICAgICAgICAgICAgICAgIDxtYXQtaWNvblxuICAgICAgICAgICAgICAgICAgY2xhc3M9XCJtZC1wcmltYXJ5LWNvbG9yXCI+ZWRpdF9ub3RlXG4gICAgICAgICAgICAgICAgPC9tYXQtaWNvbj5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgICA8IS0tIFNldmVyaXR5IGxldmVsIHN0cmluZyAtLT5cbiAgICAgICAgICA8bmctY29udGFpbmVyIG1hdENvbHVtbkRlZj1cInNldmVyaXR5XCI+XG4gICAgICAgICAgICA8dGggbWF0LWhlYWRlci1jZWxsICptYXRIZWFkZXJDZWxsRGVmPlNldmVyaXR5PC90aD5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCB2YWxpZGF0aW9uUmVzdWx0SXRlbVwiPlxuICAgICAgICAgICAgICB7e3ZhbGlkYXRpb25SZXN1bHRJdGVtLnNldmVyaXR5fX1cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPCEtLSBTZXZlcml0eSBsZXZlbCBzdHJpbmcgLS0+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciBtYXRDb2x1bW5EZWY9XCJmaGlyUGF0aFwiPlxuICAgICAgICAgICAgPHRoIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZj5GSElSIHBhdGg8L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHZhbGlkYXRpb25SZXN1bHRJdGVtXCI+XG4gICAgICAgICAgICAgIHt7dmFsaWRhdGlvblJlc3VsdEl0ZW0/LmV4cHJlc3Npb24/LlswXX19XG4gICAgICAgICAgICA8L3RkPlxuICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgIDwhLS0gVGhlIGxvY2F0aW9uIGFzIHJldHVybmVkIGJ5IHRoZSBzZXJ2ZXIuIE5vdGUgdGhhdCB0aGUgcmVzb3VyY2UgcmV0dXJuZWQgYnkgdGhlICByZXNwb25zZSBjb3VsZCBiZVxuICAgICAgICAgIGZvcm1hdHRlZCBkaWZmZXJlbnRseSB0aGVuIHRoZSByZXF1ZXN0IHJlc291cmNlLiBXaGF0IHRoaXMgbWVhbnMgaXMgdGhlIHRoZSBsaW5lIG51bWJlcnMgaW4gdGhlIHJlc3BvbnNlXG4gICAgICAgICAgcmVzb3VyY2UgbWFueSBub3QgbWF0Y2ggdGhvc2UgaW4gdGhlIHJlcXVlc3QuLS0+XG4gICAgICAgICAgPG5nLWNvbnRhaW5lciBtYXRDb2x1bW5EZWY9XCJsb2NhdGlvblwiPlxuICAgICAgICAgICAgPHRoIG1hdC1oZWFkZXItY2VsbCAqbWF0SGVhZGVyQ2VsbERlZiBpZD1cImxvY2F0aW9uLWNvbHVtbi1oZWFkZXJcIj4gTG9jYXRpb248L3RoPlxuICAgICAgICAgICAgPHRkIG1hdC1jZWxsICptYXRDZWxsRGVmPVwibGV0IHZhbGlkYXRpb25SZXN1bHRJdGVtXCIgKGNsaWNrKT1cIm9uTG9jYXRpb25TZWxlY3RlZCh2YWxpZGF0aW9uUmVzdWx0SXRlbSlcIj5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJsb2NhdGlvbi1kYXRhXCI+IHt7dmFsaWRhdGlvblJlc3VsdEl0ZW0ubG9jYXRpb259fTwvc3Bhbj5cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPCEtLSBFeHBhbmRlZCBDb250ZW50IENvbHVtbiAtIFRoZSBkZXRhaWwgcm93IGlzIG1hZGUgdXAgb2YgdGhpcyBvbmUgY29sdW1uIHRoYXQgc3BhbnMgYWNyb3NzIGFsbCBjb2x1bW5zIC0tPlxuICAgICAgICAgIDxuZy1jb250YWluZXIgbWF0Q29sdW1uRGVmPVwiZXhwYW5kZWREZXRhaWxcIj5cbiAgICAgICAgICAgIDx0ZCBtYXQtY2VsbCAqbWF0Q2VsbERlZj1cImxldCB2YWxpZGF0aW9uUmVzdWx0SXRlbVwiIFthdHRyLmNvbHNwYW5dPVwiZGlzcGxheWVkQ29sdW1ucz8ubGVuZ3RoXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2YWxpZGF0aW9uLXJlc3VsdC1kZXRhaWxcIlxuICAgICAgICAgICAgICAgIFtAZGV0YWlsRXhwYW5kXT1cInZhbGlkYXRpb25SZXN1bHRJdGVtLmV4cGFuZGVkID8gJ2V4cGFuZGVkJyA6ICdjb2xsYXBzZWQnXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInZhbGlkYXRpb24tcmVzdWx0LXRleHQtdmFsdWVcIj5cbiAgICAgICAgICAgICAgICAgIHt7dmFsaWRhdGlvblJlc3VsdEl0ZW0uZGlhZ25vc3RpY3N9fVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgPHRyIG1hdC1oZWFkZXItcm93ICptYXRIZWFkZXJSb3dEZWY9XCJkaXNwbGF5ZWRDb2x1bW5zXCI+PC90cj5cbiAgICAgICAgICA8dHIgbWF0LXJvdyAqbWF0Um93RGVmPVwibGV0IHZhbGlkYXRpb25SZXN1bHRJdGVtOyBjb2x1bW5zOiBkaXNwbGF5ZWRDb2x1bW5zO1wiXG4gICAgICAgICAgICBjbGFzcz1cInRhYmxlLXJvd1wiXG4gICAgICAgICAgICBbY2xhc3MuZXhwYW5kZWQtcm93XT1cInZhbGlkYXRpb25SZXN1bHRJdGVtLmV4cGFuZGVkXCI+XG4gICAgICAgICAgICA8dHIgbWF0LXJvdyAqbWF0Um93RGVmPVwibGV0IHJvdzsgY29sdW1uczogWydleHBhbmRlZERldGFpbCddXCIgY2xhc3M9XCJ0ZXh0LXZhbHVlLXJvd1wiPjwvdHI+XG4gICAgICAgICAgPC90YWJsZT5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgICA8IS0tIFJlc291cmNlIGFzIHJldHVybmVkIGZyb20gdGhlIHZhbGlkYXRvci4gTm90ZSB0aGF0IHRoZSByZXNvdXJjZSByZXR1cm5lZCBmcm9tIHRoZSB2YWxpZGF0b3IgbWF5IGJlXG4gICAgICBmb3JtYXR0ZWQgZGlmZmVyZW50bHkgdGhlbiB0aGUgcmVzb3VyY2Ugd2Ugc2VudCB0byB0aGUgdmFsaWRhdG9yLiAtLT5cbiAgICAgIEBpZiAocmVzdWx0RGV0YWlsc0V4cGFuZEJ0blNob3duICYmIGFwaVJlc3BvbnNlPy5mb3JtYXR0ZWRSZXNvdXJjZSkge1xuICAgICAgICA8ZGl2IGNsYXNzPVwicGFkZGluZy10b3AtbWRcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGluZS1udW1iZXJzLXJlc3BvbnNlXCIgI251bWJlcnM+XG4gICAgICAgICAgICBAZm9yIChpdGVtIG9mIGFwaVJlc3BvbnNlPy5mb3JtYXR0ZWRSZXNvdXJjZT8uc3BsaXQoJ1xcbicpOyB0cmFjayBpdGVtOyBsZXQgaSA9ICRpbmRleCkge1xuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibnVtYmVycy1yZXNwb25zZVwiPnt7aSArIDF9fTwvZGl2PlxuICAgICAgICAgICAgfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ2YWxpZGF0b3ItcmVzcG9uc2VcIj5cbiAgICAgICAgICAgIEBmb3IgKGl0ZW0gb2YgYXBpUmVzcG9uc2U/LmZvcm1hdHRlZFJlc291cmNlPy5zcGxpdCgnXFxuJyk7IHRyYWNrIGl0ZW07IGxldCBpID0gJGluZGV4KSB7XG4gICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgIDxwcmUgW25nQ2xhc3NdPVwiZ2V0TGluZUl0ZW1DbGFzcyhpdGVtLCBpKVwiIGNsYXNzPVwibGluZS1pdGVtXCIgW2lkXT1cIidtYXJrJysgKGkrMSlcIj57e2l0ZW19fTwvcHJlPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgfVxuICAgIDwvZGl2PlxuICB9XG4iXX0=